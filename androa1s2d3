[1mdiff --git a/apis/constants.js b/apis/constants.js[m
[1mindex 7fb3391..51ddd79 100644[m
[1m--- a/apis/constants.js[m
[1m+++ b/apis/constants.js[m
[36m@@ -1,6 +1,4 @@[m
 module.exports = {[m
[31m-  TIME_TO_FINISH_THE_CONTEST: 21,[m
[31m-  TIMES_TO_START_THE_CONTEST: [9, 10, 20, 21],[m
   WEEK_PERIOD: 7,[m
   FIRST_PAGE: 1,[m
   NUMBER_OF_COVERS_IN_LIST: 20,[m
[1mdiff --git a/apis/contestService.js b/apis/contestService.js[m
[1mindex b3d7761..5d5993b 100644[m
[1m--- a/apis/contestService.js[m
[1m+++ b/apis/contestService.js[m
[36m@@ -27,10 +27,6 @@[m [mexports.getContest = function(id) {[m
   return Contest.forge({id: id}).fetch();[m
 }[m
 [m
[31m-exports.listContests = function() {[m
[31m-  return Contest.collection().fetch();[m
[31m-}[m
[31m-[m
 exports.listUnfinishedContests = function() {[m
   return Contest.collection().query({where: ['finished', 0]}).fetch();[m
 }[m
[36m@@ -39,14 +35,8 @@[m [mexports.listContestsToStart = function() {[m
   return Contest.collection().query(function(qb) {[m
     qb.leftJoin('audition', 'contest.id', 'audition.contest_id')[m
     .where('contest.finished', 0)[m
[31m-    .where(function() {[m
[31m-      this.andWhere(function() {[m
[31m-        this.whereNotNull('contest.start_date').where('contest.start_date', '<=', new Date());[m
[31m-      })[m
[31m-      .orWhere(function() {[m
[31m-        this.whereNull('contest.start_date');[m
[31m-      });[m
[31m-    })[m
[32m+[m[32m    .whereNotNull('contest.start_date')[m
[32m+[m[32m    .where('contest.start_date', '<=', new Date())[m
     .whereNull('contest.end_date')[m
     .groupBy('audition.contest_id')[m
     .havingRaw('count(audition.contest_id) >= contest.minimum_contestants');[m
[36m@@ -93,11 +83,43 @@[m [mvar chooseWinners = function(contest, transaction) {[m
   });[m
 }[m
 [m
[32m+[m[32mvar incrementVotingPowers = function(auditions, transaction) {[m
[32m+[m[32m  return $.getUsersVotes(auditions).then(function(usersVotes) {[m
[32m+[m[32m    var usersWithVotingPowerIncremented = [];[m
[32m+[m[32m    var usersPromises = [];[m
[32m+[m[32m    var usersVotesSortedByAuditionPlace = usersVotes.sortBy(function(userVote) {[m
[32m+[m[32m      return auditions.get(userVote.get('audition_id')).get('place');[m
[32m+[m[32m    });[m
[32m+[m[32m    usersVotes.reset();[m
[32m+[m[32m    usersVotes.set(usersVotesSortedByAuditionPlace);[m
[32m+[m[32m    usersVotes.forEach(function(userVote) {[m
[32m+[m[32m      var audition = auditions.get(userVote.get('audition_id'));[m
[32m+[m[32m      var user = userVote.related('user');[m
[32m+[m[32m      if(!_.contains(usersWithVotingPowerIncremented, user.id)) {[m
[32m+[m[32m        var increment = 0;[m
[32m+[m[32m        if(audition.get('place') === 1) {[m
[32m+[m[32m          increment = constants.POWER_VOTING_INCREMENT_FOR_THE_GOLD_MEDAL_VOTER;[m
[32m+[m[32m        } else if(audition.get('place') === 2) {[m
[32m+[m[32m          increment = constants.POWER_VOTING_INCREMENT_FOR_THE_SILVER_MEDAL_VOTER;[m
[32m+[m[32m        } else if(audition.get('place') === 3) {[m
[32m+[m[32m          increment = constants.POWER_VOTING_INCREMENT_FOR_THE_BRONZE_MEDAL_VOTER;[m
[32m+[m[32m        }[m
[32m+[m[32m        user.set('voting_power', user.get('voting_power') + increment);[m
[32m+[m[32m        usersWithVotingPowerIncremented.push(user.id);[m
[32m+[m[32m        usersPromises.push(user.save({voting_power: user.get('voting_power')}, {patch: true, transacting: transaction}));[m
[32m+[m[32m      }[m
[32m+[m[32m    });[m
[32m+[m[32m    return Promise.all(usersPromises);[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
 exports.finishContest = function(contest) {[m
   return Bookshelf.transaction(function(transaction) {[m
     return contest.save({finished: 1}, {patch: true, transacting: transaction}).then(function(contest) {[m
       return chooseWinners(contest, transaction);[m
     }).then(function(winners) {[m
[32m+[m[32m      return incrementVotingPowers(winners);[m
[32m+[m[32m    }).then(function(voters) {[m
       return;[m
     });[m
   });[m
[36m@@ -111,22 +133,10 @@[m [mexports.startContest = function(contest) {[m
         var now = new Date();[m
         if(totalAuditions >= contest.get('minimum_contestants') && (!start || now > start)) {[m
           if(!start || now > start) {[m
[31m-            var momentToStart = moment(now);[m
[31m-            var foundTimeToStart = constants.TIMES_TO_START_THE_CONTEST.some(function(hourToStart) {[m
[31m-              if(momentToStart.hour() < hourToStart) {[m
[31m-                momentToStart.hour(hourToStart);[m
[31m-                return true;[m
[31m-              } else {[m
[31m-                return false;[m
[31m-              }[m
[31m-            });[m
[31m-            if(foundTimeToStart === false) {[m
[31m-              momentToStart.add(1, 'days').hour(constants.TIMES_TO_START_THE_CONTEST[0]);[m
[31m-            }[m
[31m-            start = momentToStart.toDate();[m
[32m+[m[32m            start = now;[m
           }[m
[31m-          contest.set('start_date', moment(start).minutes(0).second(0).toDate());[m
[31m-          contest.set('end_date', moment(contest.get('start_date')).add(contest.get('duration'), 'days').hours(constants.TIME_TO_FINISH_THE_CONTEST).minutes(0).second(0).toDate());[m
[32m+[m[32m          contest.set('start_date', start);[m
[32m+[m[32m          contest.set('end_date', moment(start).add(contest.get('duration') + 1, 'days').hours(0).minutes(0).seconds(0).toDate());[m
           contest.save({start_date: contest.get('start_date'), end_date: contest.get('end_date')}, {patch: true}).then(function(contest) {[m
             resolve(contest);[m
             mailService.contestStart(contest).catch(function(err) {[m
[36m@@ -149,66 +159,53 @@[m [mexports.startContest = function(contest) {[m
   });[m
 }[m
 [m
[31m-var createAudition = function(user, contest, auditionData) {[m
[32m+[m[32mexports.submitAudition = function(user, contest, auditionData) {[m
   return new Promise(function(resolve, reject) {[m
[31m-    youtube.getVideoInfos(auditionData.url).then(function(videoInfos) {[m
[31m-      if(videoInfos.channelId === user.get('youtube_account')) {[m
[31m-        if(videoInfos.date > contest.get('acceptance_date') && (_.isUndefined(contest.get('end_date')) || _.isNull(contest.get('end_date')) || videoInfos.date < contest.get('end_date'))) {[m
[31m-          var audition = Audition.forge(auditionData);[m
[31m-          audition.set('contest_id', contest.id);[m
[31m-          audition.set('user_id', user.id);[m
[31m-          audition.set('url', videoInfos.url);[m
[31m-          audition.set('embed_url', videoInfos.embedUrl);[m
[31m-          audition.set('video_id', videoInfos.id);[m
[31m-          audition.set('small_thumbnail', videoInfos.thumbnails.small);[m
[31m-          audition.set('medium_thumbnail', videoInfos.thumbnails.medium);[m
[31m-          audition.set('large_thumbnail', videoInfos.thumbnails.large);[m
[31m-          audition.set('slug', slug.slugify(audition.get('title')) + '-' + slug.slugify(user.get('name')));[m
[31m-          audition.save().then(function(audition) {[m
[31m-            resolve(audition);[m
[31m-            mailService.contestJoin(user, contest, audition).catch(function(err) {[m
[31m-              console.log('Error sending "contest join" email to user ' + user.id + ': ' + err.message);[m
[31m-            });[m
[31m-          }).catch(function(err) {[m
[31m-            if(err.code === 'ER_DUP_ENTRY') {[m
[31m-              reject(messages.apiError('contest.join.userAlreadyInContest', 'The user is already in contest', err));[m
[31m-            } else {[m
[31m-              reject(messages.unexpectedError('Error adding audition in contest', err));[m
[31m-            }[m
[31m-          });[m
[31m-        } else {[m
[32m+[m[32m    Contest.forge({id: contest.id}).fetch().then(function(contestFetched) {[m
[32m+[m[32m      if(contestFetched.getProgress() === 'finished') {[m
[32m+[m[32m        reject(messages.apiError('contest.join.alreadyFinished', 'The contest was already finished'));[m
[32m+[m[32m        return;[m
[32m+[m[32m      }[m
[32m+[m[32m      youtube.getVideoInfos(auditionData.url).then(function(videoInfos) {[m
[32m+[m[32m        if(videoInfos.channelId !== user.get('youtube_account')) {[m
[32m+[m[32m          reject(messages.apiError('contest.join.videoNotOwnedByUser', 'This video URL is not owned by the user'));[m
[32m+[m[32m          return;[m
[32m+[m[32m        }[m
[32m+[m[32m        if(videoInfos.date < contestFetched.get('acceptance_date') || (contestFetched.get('end_date') && videoInfos.date > contestFetched.get('end_date'))) {[m
           reject(messages.apiError('contest.join.videoDateIsNotValid', 'The date of this video can not be older or younger than the contest'));[m
[32m+[m[32m          return;[m
         }[m
[31m-      } else {[m
[31m-        reject(messages.apiError('contest.join.videoNotOwnedByUser', 'This video URL is not owned by the user'));[m
[31m-      }[m
[31m-    }).catch(function(err) {[m
[31m-      reject(messages.apiError('contest.join.errorGettingVideoInfos', 'Error getting video information', err));[m
[31m-    });[m
[31m-  });[m
[31m-}[m
[31m-[m
[31m-exports.joinContest = function(user, auditionData) {[m
[31m-  return new Promise(function(resolve, reject) {[m
[31m-    Contest.forge({id: auditionData.contest_id}).fetch().then(function(contest) {[m
[31m-      this.contest = contest;[m
[31m-      if(contest.getProgress() === 'finished') {[m
[31m-        throw messages.apiError('contest.join.alreadyFinished', 'The contest was already finished');[m
[31m-      } else {[m
[31m-        return createAudition(user, contest, auditionData);[m
[31m-      }[m
[31m-    }).then(function(audition) {[m
[31m-      this.audition = audition;[m
[31m-      $.startContest(this.contest).then(function(contest) {[m
[31m-        return contest;[m
[32m+[m[32m        var audition = Audition.forge(auditionData);[m
[32m+[m[32m        audition.set('approved', 0);[m
[32m+[m[32m        audition.set('contest_id', contestFetched.id);[m
[32m+[m[32m        audition.set('user_id', user.id);[m
[32m+[m[32m        audition.set('url', videoInfos.url);[m
[32m+[m[32m        audition.set('embed_url', videoInfos.embedUrl);[m
[32m+[m[32m        audition.set('video_id', videoInfos.id);[m
[32m+[m[32m        audition.set('small_thumbnail', videoInfos.thumbnails.small);[m
[32m+[m[32m        audition.set('medium_thumbnail', videoInfos.thumbnails.medium);[m
[32m+[m[32m        audition.set('large_thumbnail', videoInfos.thumbnails.large);[m
[32m+[m[32m        audition.set('slug', slug.slugify(audition.get('title')) + '-' + slug.slugify(user.get('name')));[m
[32m+[m[32m        audition.save().then(function(auditionSaved) {[m
[32m+[m[32m          $.startContest(contestFetched).finally(function() {[m
[32m+[m[32m            resolve(auditionSaved);[m
[32m+[m[32m          });[m
[32m+[m[32m          mailService.auditionSubmit(user, contestFetched, auditionSaved).catch(function(err) {[m
[32m+[m[32m            console.log('Error sending "audition submit" email to user ' + user.id + ': ' + err.message);[m
[32m+[m[32m          });[m
[32m+[m[32m        }).catch(function(err) {[m
[32m+[m[32m          if(err.code === 'ER_DUP_ENTRY') {[m
[32m+[m[32m            reject(messages.apiError('contest.join.userAlreadyInContest', 'The user is already in contest', err));[m
[32m+[m[32m          } else {[m
[32m+[m[32m            reject(messages.unexpectedError('Error adding audition in contest', err));[m
[32m+[m[32m          }[m
[32m+[m[32m        });[m
       }).catch(function(err) {[m
[31m-        return;[m
[32m+[m[32m        reject(messages.apiError('contest.join.errorGettingVideoInfos', 'Error getting video information', err));[m
       });[m
[31m-    }).then(function(contest) {[m
[31m-      resolve({audition: this.audition, contest: this.contest});[m
     }).catch(function(err) {[m
[31m-      reject(err);[m
[31m-    }).bind({});[m
[32m+[m[32m      reject(messages.unexpectedError('Error fetching contest', err));[m
[32m+[m[32m    });[m
   });[m
 }[m
 [m
[36m@@ -237,6 +234,7 @@[m [mexports.getUserAudition = function(user, contest) {[m
 exports.getUserAuditions = function(user) {[m
   return Audition.collection().query(function(qb) {[m
     qb.where('user_id', user.id);[m
[32m+[m[32m    qb.where('approved', 1)[m
     qb.orderBy('registration_date', 'desc');[m
   }).fetch(auditionWithContestRelated);[m
 }[m
[36m@@ -246,6 +244,7 @@[m [mvar listAuditions = function(rankType, contest, page, pageSize) {[m
   pageSize = parseInt(pageSize);[m
   return Audition.collection().query(function(qb) {[m
     qb.where('contest_id', contest.id);[m
[32m+[m[32m    qb.where('approved', 1);[m
     if(page && pageSize) {[m
       qb.offset((page - 1) * pageSize);[m
       qb.limit(pageSize);[m
[36m@@ -273,6 +272,7 @@[m [mexports.totalAuditions = function(contest) {[m
     var qb = Bookshelf.knex('audition')[m
     .count('id as total_auditions')[m
     .where('contest_id', contest.id)[m
[32m+[m[32m    .where('approved', 1)[m
     .then(function(rows) {[m
       resolve(parseInt(rows[0].total_auditions));[m
     }).catch(function(err) {[m
[36m@@ -396,33 +396,37 @@[m [mexports.countUserVotes = function(user, contest) {[m
 }[m
 [m
 exports.vote = function(user, audition) {[m
[32m+[m[32m  console.log('User voting: ' + user);[m
   return new Promise(function(resolve, reject) {[m
     audition.fetch(auditionWithContestRelated).then(function(auditionFetched) {[m
       var contest = auditionFetched.related('contest');[m
       $.countUserVotes(user, contest).then(function(totalAuditionsVotes) {[m
[31m-        if(totalAuditionsVotes < constants.VOTE_LIMIT) {[m
[31m-          if(contest.getProgress() !== 'finished') {[m
[31m-            var auditionOwner = auditionFetched.related('user');[m
[31m-            if(user.id !== auditionOwner.id) {[m
[31m-              var userVote = UserVote.forge({user_id: user.id, audition_id: auditionFetched.id, voting_power: user.get('voting_power')});[m
[31m-              userVote.save().then(function(userVote) {[m
[31m-                resolve(userVote);[m
[31m-              }).catch(function(err) {[m
[31m-                if(err.code === 'ER_DUP_ENTRY') {[m
[31m-                  reject(messages.apiError('audition.vote.userAlreadyVoted', 'The user already voted in audition', err));[m
[31m-                } else {[m
[31m-                  reject(messages.unexpectedError('Error voting in audition', err));[m
[31m-                }[m
[31m-              });[m
[31m-            } else {[m
[31m-              reject(messages.apiError('audition.vote.canNotVoteForYourself', 'The user can not vote for yourself', err));[m
[31m-            }[m
[31m-          } else {[m
[31m-            reject(messages.apiError('audition.vote.contestWasFinished', 'The user can not vote anymore because the contest was finished'));[m
[31m-          }[m
[31m-        } else {[m
[32m+[m[32m        if(totalAuditionsVotes >= constants.VOTE_LIMIT) {[m
           reject(messages.apiError('audition.vote.reachVoteLimit', 'The user reached the vote limit of ' + constants.VOTE_LIMIT));[m
[32m+[m[32m          return;[m
[32m+[m[32m        }[m
[32m+[m[32m        if(contest.getProgress() === 'finished') {[m
[32m+[m[32m          reject(messages.apiError('audition.vote.contestWasFinished', 'The user can not vote anymore because the contest was finished'));[m
[32m+[m[32m          return;[m
[32m+[m[32m        }[m
[32m+[m[32m        if(user.id === auditionFetched.related('user').id) {[m
[32m+[m[32m          reject(messages.apiError('audition.vote.canNotVoteForYourself', 'The user can not vote for yourself'));[m
[32m+[m[32m          return;[m
[32m+[m[32m        }[m
[32m+[m[32m        if(auditionFetched.get('approved') === 0) {[m
[32m+[m[32m          reject(messages.apiError('audition.vote.auditionNotApproved', 'The user can not vote in audition not approved'));[m
[32m+[m[32m          return;[m
         }[m
[32m+[m[32m        var userVote = UserVote.forge({user_id: user.id, audition_id: auditionFetched.id, voting_power: user.get('voting_power')});[m
[32m+[m[32m        userVote.save().then(function(userVote) {[m
[32m+[m[32m          resolve(userVote);[m
[32m+[m[32m        }).catch(function(err) {[m
[32m+[m[32m          if(err.code === 'ER_DUP_ENTRY') {[m
[32m+[m[32m            reject(messages.apiError('audition.vote.userAlreadyVoted', 'The user already voted in audition', err));[m
[32m+[m[32m          } else {[m
[32m+[m[32m            reject(messages.unexpectedError('Error voting in audition', err));[m
[32m+[m[32m          }[m
[32m+[m[32m        });[m
       }).catch(function(err) {[m
         reject(messages.unexpectedError('Error voting in audition', err));[m
       });[m
[36m@@ -435,21 +439,20 @@[m [mexports.vote = function(user, audition) {[m
 exports.removeVote = function(user, audition) {[m
   return new Promise(function(resolve, reject) {[m
     UserVote.forge({user_id: user.id, audition_id: audition.id}).fetch(userVoteWithAuditionAndContestRelated).then(function(userVote) {[m
[31m-      if(userVote) {[m
[31m-        var contest = userVote.related('audition').related('contest');[m
[31m-        if(contest.getProgress() !== 'finished') {[m
[31m-          var userVoteClone = userVote.clone();[m
[31m-          userVote.destroy().then(function() {[m
[31m-            resolve(userVoteClone);[m
[31m-          }).catch(function(err) {[m
[31m-            reject(messages.unexpectedError('Error removing vote in audition', err));[m
[31m-          });[m
[31m-        } else {[m
[31m-          reject(messages.apiError('audition.vote.contestWasFinished', 'The user can not vote anymore because the contest was finished'));[m
[31m-        }[m
[31m-      } else {[m
[32m+[m[32m      if(!userVote) {[m
         reject(messages.apiError('audition.vote.userHasNotVoted', 'The user has not voted'));[m
[32m+[m[32m        return;[m
[32m+[m[32m      }[m
[32m+[m[32m      if(userVote.related('audition').related('contest').getProgress() === 'finished') {[m
[32m+[m[32m        reject(messages.apiError('audition.vote.contestWasFinished', 'The user can not vote anymore because the contest was finished'));[m
[32m+[m[32m        return;[m
       }[m
[32m+[m[32m      var userVoteClone = userVote.clone();[m
[32m+[m[32m      userVote.destroy().then(function() {[m
[32m+[m[32m        resolve(userVoteClone);[m
[32m+[m[32m      }).catch(function(err) {[m
[32m+[m[32m        reject(messages.unexpectedError('Error removing vote in audition', err));[m
[32m+[m[32m      });[m
     }).catch(function(err) {[m
       reject(messages.unexpectedError('Error removing vote in audition', err));[m
     });[m
[1mdiff --git a/apis/mailService.js b/apis/mailService.js[m
[1mindex ef85e26..4cc5694 100644[m
[1m--- a/apis/mailService.js[m
[1m+++ b/apis/mailService.js[m
[36m@@ -44,9 +44,9 @@[m [mexports.userRegistration = function(user) {[m
   });[m
 }[m
 [m
[31m-exports.userVerification = function(user, verificationToken) {[m
[32m+[m[32mexports.auditionSubmit = function(user, contest, audition) {[m
   return new Promise(function(resolve, reject) {[m
[31m-    mailClient.post('/user/verification', {user: user.id, token: verificationToken.get('token')}, function(err, req, res, obj) {[m
[32m+[m[32m    mailClient.post('/audition/submit', {user: user.id, contest: contest.id, audition: audition.id}, function(err, req, res, obj) {[m
       if(err) {[m
         reject(err);[m
       } else {[m
[36m@@ -56,9 +56,21 @@[m [mexports.userVerification = function(user, verificationToken) {[m
   });[m
 }[m
 [m
[31m-exports.contestJoin = function(user, contest, audition) {[m
[32m+[m[32mexports.auditionApproved = function(user, contest, audition) {[m
   return new Promise(function(resolve, reject) {[m
[31m-    mailClient.post('/contest/join', {user: user.id, contest: contest.id, audition: audition.id}, function(err, req, res, obj) {[m
[32m+[m[32m    mailClient.post('/audition/approved', {user: user.id, contest: contest.id, audition: audition.id}, function(err, req, res, obj) {[m
[32m+[m[32m      if(err) {[m
[32m+[m[32m        reject(err);[m
[32m+[m[32m      } else {[m
[32m+[m[32m        resolve(obj);[m
[32m+[m[32m      }[m
[32m+[m[32m    });[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexports.auditionDisapproved = function(user, contest, audition) {[m
[32m+[m[32m  return new Promise(function(resolve, reject) {[m
[32m+[m[32m    mailClient.post('/audition/disapproved', {user: user.id, contest: contest.id, audition: audition.id}, function(err, req, res, obj) {[m
       if(err) {[m
         reject(err);[m
       } else {[m
[1mdiff --git a/apis/userService.js b/apis/userService.js[m
[1mindex 3890c9b..cb9c6a7 100644[m
[1m--- a/apis/userService.js[m
[1m+++ b/apis/userService.js[m
[36m@@ -1,93 +1,112 @@[m
[31m-var User            = require('../models/models').User,[m
[31m-    VerificationToken = require('../models/models').VerificationToken,[m
[31m-    Bookshelf       = require('../models/models').Bookshelf,[m
[31m-    modelUtils      = require('../utils/modelUtils'),[m
[31m-    encryptUtils    = require('../utils/encryptUtils'),[m
[31m-    slug            = require('../utils/slug'),[m
[31m-    mailService     = require('./mailService'),[m
[31m-    messages        = require('./messages'),[m
[31m-    uuid            = require('node-uuid'),[m
[31m-    moment          = require('moment'),[m
[31m-    Promise         = require('bluebird'),[m
[31m-    _               = require('underscore'),[m
[31m-    $               = this;[m
[32m+[m[32mvar User         = require('../models/models').User,[m
[32m+[m[32m    modelUtils   = require('../utils/modelUtils'),[m
[32m+[m[32m    encryptUtils = require('../utils/encryptUtils'),[m
[32m+[m[32m    mailService  = require('./mailService'),[m
[32m+[m[32m    messages     = require('./messages'),[m
[32m+[m[32m    Promise      = require('bluebird'),[m
[32m+[m[32m    _            = require('underscore'),[m
[32m+[m[32m    $            = this;[m
 [m
 exports.forge = function(userData) {[m
   return User.forge(userData);[m
 }[m
 [m
[31m-exports.createTemporaryFacebookAccount = function(facebookAccount, name, gender, email) {[m
[31m-  return $.forge({name: name, gender: gender, email: email, facebook_email: email, profile_picture: 'facebook', facebook_account: facebookAccount});[m
[32m+[m[32mexports.createTemporaryFacebookAccount = function(facebookAccount, name, gender) {[m
[32m+[m[32m  return $.forge({permission: 'user', name: name, gender: gender, primary_network: 'facebook', facebook_account: facebookAccount});[m
 }[m
 [m
[31m-exports.createTemporaryTwitterAccount = function(twitterAccount, picture) {[m
[31m-  return $.forge({twitter_account: twitterAccount, twitter_picture: picture});[m
[32m+[m[32mexports.createTemporaryTwitterAccount = function(twitterAccount, name, gender, picture) {[m
[32m+[m[32m  return $.forge({permission: 'user', name: name, gender: gender, primary_network: 'twitter', twitter_account: twitterAccount, twitter_picture: picture});[m
 }[m
 [m
[31m-exports.createTemporaryGoogleAccount = function(googleAccount, picture) {[m
[31m-  return $.forge({google_account: googleAccount, google_picture: picture});[m
[32m+[m[32mexports.createTemporaryGoogleAccount = function(googleAccount, name, gender, picture) {[m
[32m+[m[32m  return $.forge({permission: 'user', name: name, gender: gender, primary_network: 'google', google_account: googleAccount, google_picture: picture});[m
 }[m
 [m
[31m-exports.createTemporaryYouTubeAccount = function(youTubeAccount) {[m
[31m-  return $.forge({youtube_account: youTubeAccount});[m
[32m+[m[32mexports.createTemporaryYouTubeAccount = function(youTubeAccount, name) {[m
[32m+[m[32m  return $.forge({permission: 'user', name: name, youtube_account: youTubeAccount});[m
 }[m
 [m
[31m-exports.connectNetwork = function(user, networkType, networkAccount) {[m
[32m+[m[32mexports.connectNetwork = function(email, password, user, networkType, networkAccount) {[m
   return new Promise(function(resolve, reject) {[m
     var association = null;[m
[31m-    if(networkType === 'twitter') {[m
[32m+[m[32m    if(networkType === 'facebook') {[m
[32m+[m[32m      association = {facebook_account: networkAccount};[m
[32m+[m[32m    } else if(networkType === 'twitter') {[m
       association = {twitter_account: networkAccount};[m
     } else if(networkType === 'google') {[m
       association = {google_account: networkAccount};[m
[31m-    } else if(networkType === 'youtube') {[m
[31m-      association = {youtube_account: networkAccount};[m
     }[m
     if(association) {[m
[31m-      resolve(user.save(association, {patch: true}));[m
[32m+[m[32m      $.authenticate(email, password).then(function(userAuthenticated) {[m
[32m+[m[32m        if(userAuthenticated) {[m
[32m+[m[32m          resolve(user.save(association, {patch: true}));[m
[32m+[m[32m        } else {[m
[32m+[m[32m          reject(messages.apiError('user.auth.accountNotFound', 'Account with email ' + email + ' and password was not found'));[m
[32m+[m[32m        }[m
[32m+[m[32m      }).catch(function(err) {[m
[32m+[m[32m        reject(messages.apiError('user.auth.errorAuthenticating', 'Error authenticating user with email ' + email));[m
[32m+[m[32m      });[m
     } else {[m
       reject(messages.apiError('user.auth.unsupportedNetworkAssociation', 'Association with network ' + networkType + ' is not supported'));[m
     }[m
   });[m
 }[m
 [m
[31m-exports.connectTwitterAccount = function(user, twitterAccount) {[m
[31m-  return $.connectNetwork(user, 'twitter', twitterAccount);[m
[32m+[m[32mexports.connectFacebookAccount = function(email, password, user, facebookAccount) {[m
[32m+[m[32m  return $.connectNetwork('facebook', facebookAccount);[m
 }[m
 [m
[31m-exports.connectGoogleAccount = function(user, googleAccount) {[m
[31m-  return $.connectNetwork(user, 'google', googleAccount);[m
[32m+[m[32mexports.connectTwitterAccount = function(email, password, user, twitterAccount) {[m
[32m+[m[32m  return $.connectNetwork('twitter', twitterAccount);[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexports.connectGoogleAccount = function(email, password, user, googleAccount) {[m
[32m+[m[32m  return $.connectNetwork('google', googleAccount);[m
 }[m
 [m
 exports.connectYouTubeAccount = function(user, youTubeAccount) {[m
[31m-  return $.connectNetwork(user, 'youtube', youTubeAccount);[m
[32m+[m[32m  user.set('youtube_account', youTubeAccount);[m
[32m+[m[32m  return user.save();[m
 }[m
 [m
[31m-exports.create = function(userData) {[m
[32m+[m[32mexports.authenticate = function(email, password) {[m
   return new Promise(function(resolve, reject) {[m
[31m-    if(!userData.email || userData.email.trim().length === 0) {[m
[31m-      reject(messages.apiError('user.auth.emailRequired', 'The email is required'));[m
[31m-      return;[m
[31m-    }[m
[31m-    if(userData.username && !slug.isValidUsername(userData)) {[m
[31m-      reject(messages.apiError('user.edit.invalidUsername', 'The username is invalid'));[m
[31m-      return;[m
[31m-    }[m
[31m-    var user = $.forge(modelUtils.filterAttributes(userData, 'UserCreationAttributes'));[m
[31m-    user.set('permission', 'user');[m
[31m-    if(!userData.facebook_email || user.get('email') === userData.facebook_email) {[m
[31m-      user.set('verified', 1);[m
[31m-    }[m
[31m-    user.save().then(function(userSaved) {[m
[31m-      resolve(userSaved);[m
[31m-      mailService.userRegistration(userSaved).catch(function(err) {[m
[31m-        console.log('Error sending "user registration" email to user ' + userSaved.id + ': ' + err);[m
[32m+[m[32m    $.forge({email: email}).fetch().then(function(user) {[m
[32m+[m[32m      encryptUtils.comparePassword(password, user.get('password')).then(function(equals) {[m
[32m+[m[32m        resolve(equals ? user : null);[m
       });[m
     }).catch(function(err) {[m
[31m-      reject(messages.apiError('user.auth.errorCreatingAccount', 'Unexpected error creating account', err));[m
[32m+[m[32m      reject(messages.unexpectedError('Error authenticating user', err));[m
     });[m
   });[m
 }[m
 [m
[32m+[m[32mexports.create = function(userData) {[m
[32m+[m[32m  return new Promise(function(resolve, reject) {[m
[32m+[m[32m    if(!userData.email) {[m
[32m+[m[32m      reject(messages.apiError('user.auth.emailRequired', 'The email is required'));[m
[32m+[m[32m    } else if(!userData.password || userData.password.length < 6) {[m
[32m+[m[32m      reject(messages.apiError('user.auth.passwordWithFewerCharacters', 'The password must contains at least 6 characteres'));[m
[32m+[m[32m    } else {[m
[32m+[m[32m      var user = $.forge(modelUtils.filterAttributes(userData, 'UserCreationAttributes'));[m
[32m+[m[32m      encryptUtils.hashPassword(user.get('password')).then(function(hash) {[m
[32m+[m[32m        user.set('password', hash);[m
[32m+[m[32m        user.save().then(function(userSaved) {[m
[32m+[m[32m          resolve(userSaved);[m
[32m+[m[32m          mailService.userRegistration(userSaved).catch(function(err) {[m
[32m+[m[32m            console.log('Error sending "user registration" email to user ' + userSaved.id + ': ' + err.message);[m
[32m+[m[32m          });[m
[32m+[m[32m        }).catch(function(err) {[m
[32m+[m[32m          reject(messages.apiError('user.auth.errorCreatingAccount', 'Unexpected error creating account'));[m
[32m+[m[32m        });[m
[32m+[m[32m      }).catch(function(err) {[m
[32m+[m[32m        reject(messages.apiError('user.auth.errorCreatingAccount', 'Unexpected error creating account'));[m
[32m+[m[32m      });[m
[32m+[m[32m    }[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
 exports.save = function(user, attributes) {[m
   if(attributes) {[m
     return user.save(user.pick(attributes), {patch: true});[m
[36m@@ -99,30 +118,10 @@[m [mexports.save = function(user, attributes) {[m
 exports.update = function(user, edited) {[m
   return new Promise(function(resolve, reject) {[m
     if(user.permission === 'admin' || user.id === edited.id) {[m
[31m-      $.forge({id: edited.id}).fetch().then(function(userFetched) {[m
[31m-        if(userFetched.get('username') && userFetched.get('username') !== edited.get('username')) {[m
[31m-          reject(messages.apiError('user.edit.cannotEditUsernameAnymore', 'The user can not edit username anymore'));[m
[31m-          return;[m
[31m-        }[m
[31m-        if(edited.get('username') && !slug.isValidUsername(edited.get('username'))) {[m
[31m-          reject(messages.apiError('user.edit.invalidUsername', 'The username is invalid'));[m
[31m-          return;[m
[31m-        }[m
[31m-        if(userFetched.get('email') !== edited.get('email')) {[m
[31m-          edited.set('verified', 0);[m
[31m-        }[m
[31m-        edited.save(edited.pick(modelUtils.modelsAttributes.UserEditableAttributes), {patch: true}).then(function(userEdited) {[m
[31m-          resolve(userEdited);[m
[31m-          if(userEdited.get('verified') === 0) {[m
[31m-            $.sendVerificationEmail(userEdited).catch(function(err) {[m
[31m-              console.log('Error sending "user verification" email to user ' + userEdited.id + ': ' + err);[m
[31m-            });[m
[31m-          }[m
[31m-        }).catch(function(err) {[m
[31m-          reject(messages.unexpectedError('Error editing user', err));[m
[31m-        });[m
[32m+[m[32m      edited.save(edited.pick(modelUtils.modelsAttributes.UserEditableAttributes), {patch: true}).then(function(userEdited) {[m
[32m+[m[32m        resolve(userEdited);[m
       }).catch(function(err) {[m
[31m-        reject(messages.unexpectedError('Error editing user', err));[m
[32m+[m[32m        reject(err);[m
       });[m
     } else {[m
       reject(messages.apiError('user.edit.noPermission', 'The user informations cannot be edited because has no permission'));[m
[36m@@ -130,8 +129,18 @@[m [mexports.update = function(user, edited) {[m
   });[m
 }[m
 [m
[31m-exports.findById = function(id) {[m
[31m-  return $.forge({id: id}).fetch();[m
[32m+[m[32mexports.getUser = function(id) {[m
[32m+[m[32m  return $.findById(id, true).then(function(user) {[m
[32m+[m[32m    return user;[m
[32m+[m[32m  }).catch(function(err) {[m
[32m+[m[32m    return $.findByUsername(id);[m
[32m+[m[32m  }).then(function(user) {[m
[32m+[m[32m    return user;[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexports.findById = function(id, required) {[m
[32m+[m[32m  return $.forge({id: id}).fetch({require: required});[m
 }[m
 [m
 exports.findByFacebookAccount = function(facebookAccount) {[m
[36m@@ -142,8 +151,8 @@[m [mexports.findByTwitterAccount = function(twitterAccount) {[m
   return $.forge({twitter_account: twitterAccount}).fetch();[m
 }[m
 [m
[31m-exports.findByGoogleAccount = function(googleAccount) {[m
[31m-  return $.forge({google_account: googleAccount}).fetch();[m
[32m+[m[32mexports.findByGoogleAccount = function(googleAccount, required) {[m
[32m+[m[32m  return $.forge({google_account: googleAccount}).fetch({require: required || false});[m
 }[m
 [m
 exports.findByEmail = function(email) {[m
[36m@@ -152,41 +161,4 @@[m [mexports.findByEmail = function(email) {[m
 [m
 exports.findByUsername = function(username) {[m
   return $.forge({username: username}).fetch();[m
[31m-}[m
[31m-[m
[31m-exports.verifyEmail = function(token) {[m
[31m-  return new Promise(function(resolve, reject) {[m
[31m-    Bookshelf.transaction(function(transaction) {[m
[31m-      return VerificationToken.forge({token: token}).fetch({withRelated: ['user'], require: true}).then(function(activationToken) {[m
[31m-        this.user = activationToken.related('user');[m
[31m-        return activationToken.destroy({transacting: transaction});[m
[31m-      }).then(function() {[m
[31m-        this.user.set('verified', 1);[m
[31m-        return this.user.save(null, {transacting: transaction});[m
[31m-      }).then(function(user) {[m
[31m-        return user;[m
[31m-      }).bind({});[m
[31m-    }).then(function(user) {[m
[31m-      resolve(user);[m
[31m-    }).catch(function(err) {[m
[31m-      reject(err);[m
[31m-    });[m
[31m-  });[m
[31m-}[m
[31m-[m
[31m-exports.sendVerificationEmail = function(user) {[m
[31m-  return VerificationToken.forge({user_id: user.id, token: uuid.v1(), expiration_date: moment().add(7, 'days').toDate()}).save(null, {method: 'insert'}).then(function(token) {[m
[31m-    return mailService.userVerification(user, token).catch(function(err) {[m
[31m-      throw messages.apiError('user.verification.errorSendingVerificationEmail', 'Error sending verification email to ' + user.get('email'));[m
[31m-    });[m
[31m-  });[m
[31m-}[m
[31m-[m
[31m-exports.resendVerificationEmail = function(user) {[m
[31m-  return user.fetch().then(function(userFetched) {[m
[31m-    if(userFetched.get('verified') === 1) {[m
[31m-      throw messages.apiError('user.verification.emailAlreadyVerified', 'The user is already verified');[m
[31m-    }[m
[31m-    return $.sendVerificationEmail(userFetched);[m
[31m-  });[m
 }[m
\ No newline at end of file[m
[1mdiff --git a/app.js b/app.js[m
[1mindex 08d96a3..6cff8da 100644[m
[1m--- a/app.js[m
[1m+++ b/app.js[m
[36m@@ -36,7 +36,7 @@[m [mapp.use(session({[m
     host: settings.redisSessionStorage.host,[m
     port: settings.redisSessionStorage.port,[m
     pass: settings.redisSessionStorage.password,[m
[31m-    prefix: 'session:'[m
[32m+[m[32m    prefix: 'session'[m
   })[m
 }));[m
 app.use(express.static(app.get('public')));[m
[1mdiff --git a/bower.json b/bower.json[m
[1mindex f723705..4074e19 100644[m
[1m--- a/bower.json[m
[1m+++ b/bower.json[m
[36m@@ -17,6 +17,7 @@[m
     "bootswatch": "v3.3.1+2",[m
     "font-awesome": "~4.2.0",[m
     "ng-flow": "~2.4.3",[m
[32m+[m[32m    "ng-password-strength": "~0.0.6",[m
     "ng-videosharing-embed": "~0.2.1",[m
     "ngprogress": "~1.0.4",[m
     "underscore": "~1.6.0"[m
[1mdiff --git a/configs/authentication.js b/configs/authentication.js[m
[1mindex c4b0dc5..8f7225c 100644[m
[1m--- a/configs/authentication.js[m
[1m+++ b/configs/authentication.js[m
[36m@@ -55,8 +55,7 @@[m [mexports.configure = function(app, passport) {[m
       if(user) {[m
         return user;[m
       } else {[m
[31m-        // return userService.createTemporaryFacebookAccount(profileInfos.id, profileInfos.name, profileInfos.gender, profileInfos.email);[m
[31m-        return userService.create({facebook_account: profileInfos.id, name: profileInfos.name, gender: profileInfos.gender, email: profileInfos.email, profile_picture: 'facebook'});[m
[32m+[m[32m        return userService.createTemporaryFacebookAccount(profileInfos.id, profileInfos.name, profileInfos.gender);[m
       }[m
     }).nodeify(new CustomDone(done).done);[m
   }));[m
[1mdiff --git a/jobs/mailSender.js b/jobs/mailSender.js[m
[1mindex 0d234ca..234b3e4 100644[m
[1m--- a/jobs/mailSender.js[m
[1m+++ b/jobs/mailSender.js[m
[36m@@ -21,8 +21,9 @@[m [mvar env = new nunjucks.Environment(new nunjucks.FileSystemLoader(mailTemplates))[m
 env.addGlobal('siteUrl', settings.siteUrl);[m
 [m
 var userRegistrationTemplate = env.getTemplate('user_registration.tpl');[m
[31m-var userVerificationTemplate = env.getTemplate('user_verification.tpl');[m
[31m-var contestJoinTemplate = env.getTemplate('contest_join.tpl');[m
[32m+[m[32mvar auditionSubmitTemplate = env.getTemplate('audition_submit.tpl');[m
[32m+[m[32mvar auditionApprovedTemplate = env.getTemplate('audition_approved.tpl');[m
[32m+[m[32mvar auditionDisapprovedTemplate = env.getTemplate('audition_disapproved.tpl');[m
 var contestStartTemplate = env.getTemplate('contest_start.tpl');[m
 var contestWinnerTemplate = env.getTemplate('contest_winner.tpl');[m
 [m
[36m@@ -39,28 +40,41 @@[m [mserver.post('/user/registration', function(req, res, next) {[m
   });[m
 });[m
 [m
[31m-server.post('/user/verification', function(req, res, next) {[m
[31m-  userService.findById(req.body.user).then(function(user) {[m
[31m-    userVerificationTemplate.render({user: user.toJSON(), token: req.body.token}, function(err, email) {[m
[31m-      mailService.send(user.get('email'), 'Confirme o seu email para participar do Cover Academy', email).then(function(mailResponse) {[m
[32m+[m[32mserver.post('/audition/submit', function(req, res, next) {[m
[32m+[m[32m  Promise.all([userService.findById(req.body.user), contestService.getContest(req.body.contest), contestService.getAudition(req.body.audition)]).spread(function(user, contest, audition) {[m
[32m+[m[32m    auditionSubmitTemplate.render({user: user.toJSON(), contest: contest.toJSON(), audition: audition.toJSON()}, function(err, email) {[m
[32m+[m[32m      mailService.send(user.get('email'), 'Você se inscreveu na competição, aguarde enquanto revisamos o seu vídeo!', email).then(function(mailResponse) {[m
[32m+[m[32m        res.send(200);[m
[32m+[m[32m      });[m
[32m+[m[32m    });[m
[32m+[m[32m  }).catch(function(err) {[m
[32m+[m[32m    console.log('Error sending "audition submit" email to user ' + req.body.user + ': ' + err);[m
[32m+[m[32m    res.send(500);[m
[32m+[m[32m  });[m
[32m+[m[32m});[m
[32m+[m
[32m+[m[32mserver.post('/audition/approved', function(req, res, next) {[m
[32m+[m[32m  Promise.all([userService.findById(req.body.user), contestService.getContest(req.body.contest), contestService.getAudition(req.body.audition)]).spread(function(user, contest, audition) {[m
[32m+[m[32m    auditionApprovedTemplate.render({user: user.toJSON(), contest: contest.toJSON(), audition: audition.toJSON()}, function(err, email) {[m
[32m+[m[32m      mailService.send(user.get('email'), 'Parabéns, o seu vídeo foi aprovado e você está participando da competição!', email).then(function(mailResponse) {[m
         res.send(200);[m
       });[m
     });[m
   }).catch(function(err) {[m
[31m-    console.log('Error sending "user verification" email to user ' + req.body.user + ': ' + err);[m
[32m+[m[32m    console.log('Error sending "audition approved" email to user ' + req.body.user + ': ' + err);[m
     res.send(500);[m
   });[m
 });[m
 [m
[31m-server.post('/contest/join', function(req, res, next) {[m
[32m+[m[32mserver.post('/audition/disapproved', function(req, res, next) {[m
   Promise.all([userService.findById(req.body.user), contestService.getContest(req.body.contest), contestService.getAudition(req.body.audition)]).spread(function(user, contest, audition) {[m
[31m-    contestJoinTemplate.render({user: user.toJSON(), contest: contest.toJSON(), audition: audition.toJSON()}, function(err, email) {[m
[31m-      mailService.send(user.get('email'), 'Você está inscrito na competição, boa sorte!', email).then(function(mailResponse) {[m
[32m+[m[32m    auditionDisapprovedTemplate.render({user: user.toJSON(), contest: contest.toJSON(), audition: audition.toJSON()}, function(err, email) {[m
[32m+[m[32m      mailService.send(user.get('email'), 'Sentimos muito, mas infelizmente o seu vídeo não foi aprovado =(', email).then(function(mailResponse) {[m
         res.send(200);[m
       });[m
     });[m
   }).catch(function(err) {[m
[31m-    console.log('Error sending "contest join" email to user ' + req.body.user + ': ' + err);[m
[32m+[m[32m    console.log('Error sending "audition disapproved" email to user ' + req.body.user + ': ' + err);[m
     res.send(500);[m
   });[m
 });[m
[1mdiff --git a/jobs/mail_templates/audition_approved.tpl b/jobs/mail_templates/audition_approved.tpl[m
[1mnew file mode 100644[m
[1mindex 0000000..ff5fa87[m
[1m--- /dev/null[m
[1m+++ b/jobs/mail_templates/audition_approved.tpl[m
[36m@@ -0,0 +1,36 @@[m
[32m+[m[32m{% extends "base.tpl" %}[m
[32m+[m
[32m+[m[32m{% set contestLink = siteUrl + "/pt-br/contest/" + contest.id + "/" + contest.slug %}[m
[32m+[m[32m{% set auditionLink = siteUrl + "/pt-br/audition/" + audition.id + "/" + audition.slug %}[m
[32m+[m
[32m+[m[32m{% block content %}[m
[32m+[m[32m  <h3>Parabéns {{ user.name }}!</h3>[m
[32m+[m[32m  <div style="color: #555; font-size: 16px;">[m
[32m+[m[32m    <p>[m
[32m+[m[32m      O seu vídeo foi aprovado. Seja bem-vindo à competição![m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p style="text-align: center; font-weight: bold;">[m
[32m+[m[32m      <a href="{{ contestLink }}" target="_blank" style="text-decoration: none;">[m
[32m+[m[32m        {{ contest.name }}[m
[32m+[m[32m      </a>[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      Nossa equipe analisou o seu vídeo e está de acordo com as regras descritas no nosso[m
[32m+[m[32m      <a href="{{ siteUrl }}/pt-br/contest/guideline" target="_blank">guia</a>.[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      Aqui está o link da sua audição:[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      <a href="{{ auditionLink }}" target="_blank" style="text-decoration: none;">[m
[32m+[m[32m        {{ auditionLink }}[m
[32m+[m[32m      </a>[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      Compartilhe este link com seus amigos, ganhe e conquiste o prêmio, boa sorte![m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p style="text-align: right; font-weight: bold;">[m
[32m+[m[32m      - Sandro Simas[m
[32m+[m[32m    </p>[m
[32m+[m[32m  </div>[m
[32m+[m[32m{% endblock %}[m
\ No newline at end of file[m
[1mdiff --git a/jobs/mail_templates/audition_disapproved.tpl b/jobs/mail_templates/audition_disapproved.tpl[m
[1mnew file mode 100644[m
[1mindex 0000000..1a83f72[m
[1m--- /dev/null[m
[1m+++ b/jobs/mail_templates/audition_disapproved.tpl[m
[36m@@ -0,0 +1,34 @@[m
[32m+[m[32m{% extends "base.tpl" %}[m
[32m+[m
[32m+[m[32m{% set contestLink = siteUrl + "/pt-br/contest/" + contest.id + "/" + contest.slug %}[m
[32m+[m[32m{% set auditionLink = siteUrl + "/pt-br/audition/" + audition.id + "/" + audition.slug %}[m
[32m+[m
[32m+[m[32m{% block content %}[m
[32m+[m[32m  <h3>Sentimos muito =(</h3>[m
[32m+[m[32m  <div style="color: #555; font-size: 16px;">[m
[32m+[m[32m    <p>[m
[32m+[m[32m      {{ user.name }}, infelizmente o seu vídeo não foi aprovado.[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p style="text-align: center; font-weight: bold;">[m
[32m+[m[32m      <a href="{{ contestLink }}" target="_blank" style="text-decoration: none;">[m
[32m+[m[32m        {{ contest.name }}[m
[32m+[m[32m      </a>[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      Nossa equipe analisou o seu vídeo e constatou que não está de acordo com algumas regras descritas no nosso[m
[32m+[m[32m      <a href="{{ siteUrl }}/pt-br/contest/guideline" target="_blank">guia</a> ou está abaixo da qualidade mínima para ser aprovado.[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      Segue o motivo:[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      {{ reason }}[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      Não desanime, você pode inscrever outros vídeos a qualquer momento. Boa sorte![m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p style="text-align: right; font-weight: bold;">[m
[32m+[m[32m      - Sandro Simas[m
[32m+[m[32m    </p>[m
[32m+[m[32m  </div>[m
[32m+[m[32m{% endblock %}[m
\ No newline at end of file[m
[1mdiff --git a/jobs/mail_templates/audition_submit.tpl b/jobs/mail_templates/audition_submit.tpl[m
[1mnew file mode 100644[m
[1mindex 0000000..9487fbb[m
[1m--- /dev/null[m
[1m+++ b/jobs/mail_templates/audition_submit.tpl[m
[36m@@ -0,0 +1,36 @@[m
[32m+[m[32m{% extends "base.tpl" %}[m
[32m+[m
[32m+[m[32m{% set contestLink = siteUrl + "/pt-br/contest/" + contest.id + "/" + contest.slug %}[m
[32m+[m[32m{% set auditionLink = siteUrl + "/pt-br/audition/" + audition.id + "/" + audition.slug %}[m
[32m+[m
[32m+[m[32m{% block content %}[m
[32m+[m[32m  <h3>Obrigado por se inscrever na competição!</h3>[m
[32m+[m[32m  <div style="color: #555; font-size: 16px;">[m
[32m+[m[32m    <p>[m
[32m+[m[32m      {{ user.name }}, falta pouco para concorrer aos prêmios.[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p style="text-align: center; font-weight: bold;">[m
[32m+[m[32m      <a href="{{ contestLink }}" target="_blank" style="text-decoration: none;">[m
[32m+[m[32m        {{ contest.name }}[m
[32m+[m[32m      </a>[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      O seu vídeo foi enviado para a nossa equipe de revisão. Eles irão analisar se o vídeo está de acordo com as regras descritas no nosso[m
[32m+[m[32m      <a href="{{ siteUrl }}/pt-br/contest/guideline" target="_blank">guia</a> e possui a qualidade mínima para ser aprovado.[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      Aqui está o link da sua audição:[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      <a href="{{ auditionLink }}" target="_blank" style="text-decoration: none;">[m
[32m+[m[32m        {{ auditionLink }}[m
[32m+[m[32m      </a>[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p>[m
[32m+[m[32m      Por favor aguarde, em alguns instantes você receberá um e-mail de confirmação.[m
[32m+[m[32m    </p>[m
[32m+[m[32m    <p style="text-align: right; font-weight: bold;">[m
[32m+[m[32m      - Sandro Simas[m
[32m+[m[32m    </p>[m
[32m+[m[32m  </div>[m
[32m+[m[32m{% endblock %}[m
\ No newline at end of file[m
[1mdiff --git a/jobs/mail_templates/contest_join.tpl b/jobs/mail_templates/contest_join.tpl[m
[1mdeleted file mode 100644[m
[1mindex e909ba8..0000000[m
[1m--- a/jobs/mail_templates/contest_join.tpl[m
[1m+++ /dev/null[m
[36m@@ -1,30 +0,0 @@[m
[31m-{% extends "base.tpl" %}[m
[31m-[m
[31m-{% set contestLink = siteUrl + "/pt-br/contest/" + contest.id + "/" + contest.slug %}[m
[31m-{% set auditionLink = siteUrl + "/pt-br/audition/" + audition.id + "/" + audition.slug %}[m
[31m-[m
[31m-{% block content %}[m
[31m-  <h3>Você está inscrito na competição!</h3>[m
[31m-  <div style="color: #555; font-size: 16px;">[m
[31m-    <p>[m
[31m-      Olá {{ user.name }}, obrigado por se inscrever na competição.[m
[31m-    </p>[m
[31m-    <p style="text-align: center; font-weight: bold;">[m
[31m-      <a href="{{ contestLink }}" target="_blank" style="text-decoration: none;">[m
[31m-        {{ contest.name }}[m
[31m-      </a>[m
[31m-    </p>[m
[31m-    <p>[m
[31m-      Aqui está o link da sua audição:[m
[31m-      <a href="{{ auditionLink }}" target="_blank" style="text-decoration: none;">[m
[31m-        {{ auditionLink }}[m
[31m-      </a>[m
[31m-    </p>[m
[31m-    <p>[m
[31m-      Agora basta compartilhar este link com seus amigos e correr atrás de votos. Boa sorte![m
[31m-    </p>[m
[31m-    <p style="text-align: right; font-weight: bold;">[m
[31m-      - Sandro Simas[m
[31m-    </p>[m
[31m-  </div>[m
[31m-{% endblock %}[m
\ No newline at end of file[m
[1mdiff --git a/jobs/mail_templates/user_registration.tpl b/jobs/mail_templates/user_registration.tpl[m
[1mindex ec9f9cb..c48d461 100644[m
[1m--- a/jobs/mail_templates/user_registration.tpl[m
[1m+++ b/jobs/mail_templates/user_registration.tpl[m
[36m@@ -17,7 +17,7 @@[m
       <a href="{{ siteUrl }}/pt-br/contest/guideline" target="_blank">guia</a>.[m
     </p>[m
     <p>[m
[31m-      Você também pode ser um juíz e nos ajudar a escolher vencedores, participe![m
[32m+[m[32m      Você também pode ser um juíz e nos ajudar a escolher os vencedores, participe![m
     </p>[m
     <p style="text-align: right; font-weight: bold;">[m
       - Sandro Simas[m
[1mdiff --git a/jobs/mail_templates/user_verification.tpl b/jobs/mail_templates/user_verification.tpl[m
[1mdeleted file mode 100644[m
[1mindex ce7c39c..0000000[m
[1m--- a/jobs/mail_templates/user_verification.tpl[m
[1m+++ /dev/null[m
[36m@@ -1,18 +0,0 @@[m
[31m-{% extends "base.tpl" %}[m
[31m-[m
[31m-{% block content %}[m
[31m-  <h3>Por favor confirme o seu email!</h3>[m
[31m-  <div style="color: #555; font-size: 16px;">[m
[31m-    <p>[m
[31m-      Olá {{ user.name }}, obrigado por fazer parte da nossa comunidade.[m
[31m-    </p>[m
[31m-    <p>[m
[31m-      Confirme o seu email para conseguir votar e participar das competições de música do Cover Academy.[m
[31m-    </p>[m
[31m-    <div style="text-align: center;">[m
[31m-      <a href="{{ siteUrl }}/pt-br/verify?token={{ token }}" style="padding: 10px 16px; font-size: 18px; line-height: 1.33; border-radius: 6px; color: #fff; background-color: #5bc0de; border-color: #46b8da; display: inline-block; margin-bottom: 0; font-weight: 400; line-height: 1.42857143; text-align: center; white-space: nowrap; vertical-align: middle; -ms-touch-action: manipulation; touch-action: manipulation; cursor: pointer; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; background-image: none; border: 1px solid transparent; text-decoration: none;">[m
[31m-        Confirmar email[m
[31m-      </a>[m
[31m-    </div>[m
[31m-  </div>[m
[31m-{% endblock %}[m
\ No newline at end of file[m
[1mdiff --git a/jobs/updateContests.js b/jobs/updateContests.js[m
[1mindex 8e82e7f..51267ec 100644[m
[1m--- a/jobs/updateContests.js[m
[1m+++ b/jobs/updateContests.js[m
[36m@@ -1,4 +1,5 @@[m
 var contestService = require('../apis/contestService'),[m
[32m+[m[32m    Contest        = require('../models/models').Contest,[m
     later          = require('later');[m
 [m
 var startContests = function() {[m
[1mdiff --git a/models/models.js b/models/models.js[m
[1mindex 9bfc25f..d37e1ff 100644[m
[1m--- a/models/models.js[m
[1m+++ b/models/models.js[m
[36m@@ -14,10 +14,12 @@[m [mvar knex = require('knex')({[m
 [m
 var Bookshelf = require('bookshelf')(knex);[m
 Bookshelf.plugin('virtuals');[m
[32m+[m[32mBookshelf.plugin('visibility');[m
 [m
 var User = Bookshelf.Model.extend({[m
   idAttribute: 'id',[m
[31m-  tableName: 'user'[m
[32m+[m[32m  tableName: 'user',[m
[32m+[m[32m  hidden: ['password'][m
 });[m
 [m
 var MusicGenre = Bookshelf.Model.extend({[m
[36m@@ -107,24 +109,15 @@[m [mvar UserVote = Bookshelf.Model.extend({[m
   }[m
 });[m
 [m
[31m-var VerificationToken = Bookshelf.Model.extend({[m
[31m-  idAttribute: 'token',[m
[31m-  tableName: 'verification_token',[m
[31m-  user: function() {[m
[31m-    return this.belongsTo(User, 'user_id');[m
[31m-  }[m
[31m-});[m
[31m-[m
 module.exports = {[m
[31m-  VerificationToken: VerificationToken,[m
[31m-  Artist: Artist,[m
[31m-  Audition: Audition,[m
[31m-  Bookshelf: Bookshelf,[m
[31m-  Contest: Contest,[m
[32m+[m[32m  User: User,[m
   Cover: Cover,[m
[31m-  Music: Music,[m
[31m-  MusicGenre: MusicGenre,[m
   PotentialCover: PotentialCover,[m
[31m-  User: User,[m
[31m-  UserVote: UserVote[m
[32m+[m[32m  MusicGenre: MusicGenre,[m
[32m+[m[32m  Artist: Artist,[m
[32m+[m[32m  Music: Music,[m
[32m+[m[32m  Contest: Contest,[m
[32m+[m[32m  Audition: Audition,[m
[32m+[m[32m  UserVote: UserVote,[m
[32m+[m[32m  Bookshelf: Bookshelf[m
 }[m
\ No newline at end of file[m
[1mdiff --git a/package.json b/package.json[m
[1mindex 7867344..629a797 100644[m
[1m--- a/package.json[m
[1m+++ b/package.json[m
[36m@@ -28,7 +28,6 @@[m
     "morgan": "~1.0.0",[m
     "mysql": "~2.3.2",[m
     "newrelic": "~1.11.0",[m
[31m-    "node-uuid": "~1.4.2",[m
     "nunjucks": "~1.1.0",[m
     "passport": "~0.2.1",[m
     "passport-facebook": "~1.0.3",[m
[1mdiff --git a/public/app/app.js b/public/app/app.js[m
[1mindex 357753f..09fb82f 100644[m
[1m--- a/public/app/app.js[m
[1m+++ b/public/app/app.js[m
[36m@@ -11,6 +11,7 @@[m [mangular[m
   'angulartics.google.analytics',[m
   'flow',[m
   'ngCookies',[m
[32m+[m[32m  'ngPasswordStrength',[m
   'ngProgress',[m
   'ngSanitize',[m
   'pascalprecht.translate',[m
[36m@@ -26,8 +27,7 @@[m [mangular[m
   USER_COOKIE: 'CoverAcademy.user'[m
 })[m
 .constant('authEvents', {[m
[31m-  USER_REGISTERED: 'userRegistered',[m
[31m-  FAIL_REGISTERING_USER: 'failRegisteringUser',[m
[32m+[m[32m  MUST_REGISTER: 'mustRegister',[m
   LOGIN_SUCCESS: 'loginSuccess',[m
   LOGIN_FAILED: 'loginFailed',[m
   LOGOUT_SUCCESS: 'logoutSuccess',[m
[36m@@ -49,8 +49,7 @@[m [mangular[m
   cover: 'app.cover',[m
   covers: 'app.covers',[m
   index: 'app.index',[m
[31m-  joinContest: 'app.joinContest',[m
[31m-  user: 'app.user'[m
[32m+[m[32m  joinContest: 'app.joinContest'[m
 })[m
 .config(['$stateProvider', '$urlRouterProvider', '$locationProvider', '$uiViewScrollProvider', '$httpProvider', '$translateProvider', '$languagesProvider', 'accessLevel', function($stateProvider, $urlRouterProvider, $locationProvider, $uiViewScrollProvider, $httpProvider, $translateProvider, $languagesProvider, accessLevel) {[m
   // Internationalization[m
[36m@@ -119,6 +118,19 @@[m [mangular[m
         }[m
       }[m
     })[m
[32m+[m[32m    // Anonymous level stages[m
[32m+[m[32m    .state('app.register', {[m
[32m+[m[32m      url: '/register',[m
[32m+[m[32m      templateUrl: '/app/partials/register.html',[m
[32m+[m[32m      controller: 'registerController',[m
[32m+[m[32m      accessLevel: accessLevel.ANONYMOUS,[m
[32m+[m[32m      resolve: {[m
[32m+[m[32m        viewService: 'viewService',[m
[32m+[m[32m        backendResponse: function($stateParams, viewService) {[m
[32m+[m[32m          return viewService.registerView();[m
[32m+[m[32m        }[m
[32m+[m[32m      }[m
[32m+[m[32m    })[m
     // Public level states[m
     .state('app.index', {[m
       url: '/',[m
[36m@@ -294,38 +306,14 @@[m [mangular[m
       }[m
     })[m
     .state('app.user', {[m
[31m-      url: '/user/:username',[m
[31m-      templateUrl: '/app/partials/user.html',[m
[31m-      controller: 'userController',[m
[31m-      accessLevel: accessLevel.PUBLIC,[m
[31m-      resolve: {[m
[31m-        viewService: 'viewService',[m
[31m-        backendResponse: function($stateParams, viewService) {[m
[31m-          return viewService.userView($stateParams.username);[m
[31m-        }[m
[31m-      }[m
[31m-    })[m
[31m-    .state('app.userId', {[m
[31m-      url: '/user?id',[m
[32m+[m[32m      url: '/user/:id',[m
       templateUrl: '/app/partials/user.html',[m
       controller: 'userController',[m
       accessLevel: accessLevel.PUBLIC,[m
       resolve: {[m
         viewService: 'viewService',[m
         backendResponse: function($stateParams, viewService) {[m
[31m-          return viewService.userIdView($stateParams.id);[m
[31m-        }[m
[31m-      }[m
[31m-    })[m
[31m-    .state('app.verify', {[m
[31m-      url: '/verify?token',[m
[31m-      templateUrl: '/app/partials/verify.html',[m
[31m-      controller: 'verifyEmailController',[m
[31m-      accessLevel: accessLevel.PUBLIC,[m
[31m-      resolve: {[m
[31m-        viewService: 'viewService',[m
[31m-        backendResponse: function($stateParams, viewService) {[m
[31m-          return viewService.verifyView($stateParams.token);[m
[32m+[m[32m          return viewService.userView($stateParams.id);[m
         }[m
       }[m
     })[m
[36m@@ -343,22 +331,10 @@[m [mangular[m
     })[m
     // Error states[m
     .state('app.404', {[m
[31m-      templateUrl: '/app/partials/errors/404.html',[m
[31m-      controller: 'errorController',[m
[31m-      resolve: {[m
[31m-        errorCode: function() {[m
[31m-          return 404;[m
[31m-        }[m
[31m-      }[m
[32m+[m[32m      templateUrl: '/app/partials/errors/404.html'[m
     })[m
     .state('app.500', {[m
[31m-      templateUrl: '/app/partials/errors/500.html',[m
[31m-      controller: 'errorController',[m
[31m-      resolve: {[m
[31m-        errorCode: function() {[m
[31m-          return 500;[m
[31m-        }[m
[31m-      }[m
[32m+[m[32m      templateUrl: '/app/partials/errors/500.html'[m
     });[m
 }])[m
 .run(['$rootScope', '$state', '$translate', '$languages', 'amMoment', 'paginationConfig', 'authEvents', 'redirections', 'authenticationService', 'seoService', function($rootScope, $state, $translate, $languages, amMoment, paginationConfig, authEvents, redirections, authenticationService, seoService) {[m
[1mdiff --git a/public/app/controllers/contestControllers.js b/public/app/controllers/contestControllers.js[m
[1mindex 6f91af4..49efebd 100644[m
[1m--- a/public/app/controllers/contestControllers.js[m
[1m+++ b/public/app/controllers/contestControllers.js[m
[36m@@ -34,7 +34,7 @@[m [mangular[m
   });[m
 [m
   $scope.isContestant = function() {[m
[31m-    return Boolean($scope.audition && angular.isDefined($scope.audition.id))[m
[32m+[m[32m    return Boolean($scope.audition && $scope.audition.id);[m
   };[m
   $scope.hasAuditions = function() {[m
     return $scope.auditions.length !== 0;[m
[36m@@ -45,6 +45,9 @@[m [mangular[m
   $scope.hasUserVotes = function() {[m
     return $scope.userVotes && $scope.userVotes.length > 0;[m
   };[m
[32m+[m[32m  $scope.isAuditionApproved = function() {[m
[32m+[m[32m    return $scope.isContestant() && $scope.audition.approved === 1;[m
[32m+[m[32m  };[m
   $scope.isMedal = function(audition, expected) {[m
     return $scope.getMedal(audition) === expected;[m
   };[m
[36m@@ -114,8 +117,8 @@[m [mangular[m
 .controller('joinContestController', ['$scope', '$state', '$stateParams', '$translate', 'constants', 'authEvents', 'backendResponse', 'seoService', 'authenticationService', 'alertService', 'translationService', 'contestService', function($scope, $state, $stateParams, $translate, constants, authEvents, backendResponse, seoService, authenticationService, alertService, translationService, contestService) {[m
   $scope.siteUrl = constants.SITE_URL;[m
   $scope.contest = backendResponse.data.contest;[m
[32m+[m[32m  $scope.userAudition = backendResponse.data.audition;[m
   $scope.audition = {contest_id: $scope.contest.id};[m
[31m-  $scope.userAudition = null;[m
   $scope.usingYoutubeAccount = false;[m
 [m
   $translate(['seo.title.join_contest', 'seo.description.join_contest', 'seo.keywords.join_contest']).then(function(translations) {[m
[36m@@ -135,7 +138,7 @@[m [mangular[m
     $scope.usingYoutubeAccount = false;[m
   });[m
   $scope.isContestant = function() {[m
[31m-    return Boolean($scope.userAudition && angular.isDefined($scope.userAudition.id))[m
[32m+[m[32m    return Boolean($scope.userAudition && $scope.userAudition.id);[m
   };[m
   $scope.isContestProgress = function(expectedProgress) {[m
     var progress;[m
[36m@@ -164,7 +167,7 @@[m [mangular[m
     });[m
   };[m
   $scope.joinContest = function() {[m
[31m-    contestService.joinContest($scope.audition).then(function(response) {[m
[32m+[m[32m    contestService.submitAudition($scope.audition, $scope.contest).then(function(response) {[m
       var audition = response.data;[m
       $state.go('app.audition', {locale: $scope.locale(), id: audition.id, slug: audition.slug});[m
       $translate('alerts.congratulations_now_you_are_in_the_contest').then(function(translation) {[m
[36m@@ -205,6 +208,12 @@[m [mangular[m
     $scope.totalUserVotes = 0;[m
   });[m
 [m
[32m+[m[32m  $scope.isAuditionApproved = function() {[m
[32m+[m[32m    return $scope.audition.approved === 1;[m
[32m+[m[32m  };[m
[32m+[m[32m  $scope.hasAuditions = function(auditions) {[m
[32m+[m[32m    return auditions && auditions.length > 0;[m
[32m+[m[32m  };[m
   $scope.isWinner = function() {[m
     return angular.isDefined($scope.audition.place) && $scope.audition.place !== null;[m
   };[m
[1mdiff --git a/public/app/controllers/controllers.js b/public/app/controllers/controllers.js[m
[1mindex b5758b7..c3f4b75 100644[m
[1m--- a/public/app/controllers/controllers.js[m
[1m+++ b/public/app/controllers/controllers.js[m
[36m@@ -13,9 +13,13 @@[m [mangular[m
 [m
   $scope.isAuthenticated = authenticationService.isAuthenticated;[m
   $scope.user = authenticationService.getUser;[m
[32m+[m[32m  $scope.temporaryUser = authenticationService.getTemporaryUser;[m
   $scope.login = authenticationService.login;[m
   $scope.logout = authenticationService.logout;[m
 [m
[32m+[m[32m  $scope.$on(authEvents.MUST_REGISTER, function() {[m
[32m+[m[32m    $state.go('app.register', {locale: $scope.locale()});[m
[32m+[m[32m  });[m
   $scope.$on(authEvents.NOT_AUTHORIZED, function() {[m
     $state.go('app.index', {locale: $scope.locale()});[m
     // $translate('alerts.not_authorized').then(function(translation) {[m
[36m@@ -50,23 +54,10 @@[m [mangular[m
   $scope.$on(authEvents.LOGOUT_SUCCESS, function() {[m
     $state.go($state.current, $stateParams, {reload: true});[m
   });[m
[31m-  $scope.$on(authEvents.USER_REGISTERED, function() {[m
[31m-[m
[31m-  });[m
[31m-  $scope.$on(authEvents.FAIL_REGISTERING_USER, function() {[m
[31m-[m
[31m-  });[m
 [m
   $scope.isLocale = function(locale) {[m
     return $translate.use() === locale;[m
   };[m
[31m-  $scope.userState = function(user) {[m
[31m-    if(user.username) {[m
[31m-      return 'app.user({locale: "' + $scope.locale() + '", username: "' + user.username + '"})';[m
[31m-    } else {[m
[31m-      return 'app.userId({locale: "' + $scope.locale() + '", id: "' + user.id + '"})';[m
[31m-    }[m
[31m-  };[m
 }])[m
 .controller('rootController', ['$scope', '$state', '$translate', function($scope, $state, $translate) {[m
   $state.go('app.index', {locale: $translate.use()});[m
[36m@@ -288,9 +279,4 @@[m [mangular[m
       });[m
     }[m
   };[m
[31m-}])[m
[31m-.controller('errorController', ['$translate', 'errorCode', 'seoService', function($translate, errorCode, seoService) {[m
[31m-  $translate('seo.title.error_' + errorCode).then(function(translation) {[m
[31m-    seoService.setTitle(translation);[m
[31m-  });[m
 }]);[m
\ No newline at end of file[m
[1mdiff --git a/public/app/controllers/userControllers.js b/public/app/controllers/userControllers.js[m
[1mindex 32caa69..6ec3fc9 100644[m
[1m--- a/public/app/controllers/userControllers.js[m
[1m+++ b/public/app/controllers/userControllers.js[m
[36m@@ -1,41 +1,59 @@[m
 angular[m
 .module('coverAcademy.controllers')[m
[31m-.controller('registerController', ['$scope', '$modalInstance', '$translate', 'constants', 'temporaryUser', 'translationService', 'alertService', 'userService', function($scope, $modalInstance, $translate, constants, temporaryUser, translationService, alertService, userService) {[m
[31m-  $scope.temporaryUser = temporaryUser;[m
[31m-  $scope.siteUrl = constants.SITE_URL;[m
[31m-  $scope.locale = $translate.use();[m
[31m-  $scope.close = function(result) {[m
[31m-    $modalInstance.close(result);[m
[31m-  };[m
[31m-  $scope.cancel = function(reason) {[m
[31m-    $modalInstance.dismiss(reason || 'cancel');[m
[32m+[m[32m.controller('registerController', ['$scope', '$state', '$timeout', 'backendResponse', 'authenticationService', 'alertService', 'userService', 'seoService', 'translationService', function($scope, $state, $timeout, backendResponse, authenticationService, alertService, userService, seoService, translationService) {[m
[32m+[m[32m  $scope.user = backendResponse.data.temporaryUser;[m
[32m+[m[32m  $scope.emailChecked = false;[m
[32m+[m[32m  $scope.userRegistered = false;[m
[32m+[m[32m  $scope.userFound = null;[m
[32m+[m[32m  $scope.previousState = null;[m
[32m+[m
[32m+[m[32m  $scope.$on('$stateChangeSuccess', function(event, toState, toParams, fromState, fromParams) {[m
[32m+[m[32m    $scope.previousState = {state: fromState, params: fromParams};[m
[32m+[m[32m  });[m
[32m+[m
[32m+[m[32m  $scope.getNetworkConnection = function() {[m
[32m+[m[32m    return userService.getPrimaryNetworkConnection($scope.user);[m
   };[m
[31m-  $scope.sampleUsername = function() {[m
[31m-    if(!$scope.temporaryUser.username || $scope.temporaryUser.username.length === 0) {[m
[31m-      return '<username>';[m
[31m-    }[m
[31m-    return $scope.temporaryUser.username.toLowerCase();[m
[32m+[m[32m  $scope.isNetworkConnection = function(network) {[m
[32m+[m[32m    return userService.isPrimaryNetworkConnection($scope.user, network);[m
   };[m
[31m-  $scope.confirm = function() {[m
[31m-    userService.create($scope.temporaryUser).then(function(response) {[m
[31m-      $scope.close(true);[m
[32m+[m[32m  $scope.checkEmail = function() {[m
[32m+[m[32m    userService.getByEmail($scope.user.email).then(function(response) {[m
[32m+[m[32m      $scope.emailChecked = true;[m
[32m+[m[32m      $scope.userFound = response.data;[m
     }).catch(function(err) {[m
       translationService.translateError(err).then(function(translation) {[m
         alertService.addAlert('danger', translation);[m
       });[m
     });[m
   };[m
[31m-}])[m
[31m-.controller('loginController', ['$scope', '$modalInstance', 'authenticationService', function($scope, $modalInstance, authenticationService) {[m
[31m-  $scope.close = function(result) {[m
[31m-    $modalInstance.close(result);[m
[32m+[m[32m  var confirmConnection = function() {[m
[32m+[m[32m    authenticationService.updateUser().then(function(userUpdated) {[m
[32m+[m[32m      $scope.userRegistered = true;[m
[32m+[m[32m      if($scope.previousState) {[m
[32m+[m[32m        $timeout(function() {[m
[32m+[m[32m          $state.go($scope.previousState.state.name, $scope.previousState.params);[m
[32m+[m[32m        }, 10000);[m
[32m+[m[32m      }[m
[32m+[m[32m    });[m
   };[m
[31m-  $scope.cancel = function(reason) {[m
[31m-    $modalInstance.dismiss(reason || 'cancel');[m
[32m+[m[32m  $scope.register = function() {[m
[32m+[m[32m    userService.create($scope.user).then(function(response) {[m
[32m+[m[32m      confirmConnection();[m
[32m+[m[32m    }).catch(function(err) {[m
[32m+[m[32m      translationService.translateError(err).then(function(translation) {[m
[32m+[m[32m        alertService.addAlert('danger', translation);[m
[32m+[m[32m      });[m
[32m+[m[32m    });[m
   };[m
[31m-  $scope.login = function(provider) {[m
[31m-    authenticationService.login(provider).finally(function() {[m
[31m-      $modalInstance.close(authenticationService.isAuthenticated());[m
[32m+[m[32m  $scope.confirm = function() {[m
[32m+[m[32m    var connection = $scope.getNetworkConnection();[m
[32m+[m[32m    userService.connect($scope.userFound.email, $scope.userFound.password, $scope.userFound, connection.type, connection.account).then(function(response) {[m
[32m+[m[32m      confirmConnection();[m
[32m+[m[32m    }).catch(function(err) {[m
[32m+[m[32m      translationService.translateError(err).then(function(translation) {[m
[32m+[m[32m        alertService.addAlert('danger', translation);[m
[32m+[m[32m      });[m
     });[m
   };[m
 }])[m
[36m@@ -50,55 +68,24 @@[m [mangular[m
     return authenticationService.getUser() && authenticationService.getUser().id === $scope.user.id;[m
   };[m
 }])[m
[31m-.controller('settingsController', ['$scope', '$translate', 'constants', 'alertService', 'userService', 'seoService', 'translationService', function($scope, $translate, constants, alertService, userService, seoService, translationService) {[m
[31m-  $scope.siteUrl = constants.SITE_URL;[m
[32m+[m[32m.controller('settingsController', ['$scope', '$translate', 'authenticationService', 'alertService', 'userService', 'seoService', 'translationService', function($scope, $translate, authenticationService, alertService, userService, seoService, translationService) {[m
[32m+[m[32m  $scope.user = authenticationService.getUser();[m
 [m
[31m-  $scope.setUser = function(user) {[m
[31m-    $scope.user = user;[m
[31m-    $scope.initialUsername = $scope.user.username;[m
[31m-    $scope.initialEmail = $scope.user.email;[m
[31m-  };[m
[31m-[m
[31m-  $scope.setUser($scope.user());[m
[31m-[m
[31m-  $translate('seo.title.settings').then(function(translation) {[m
[32m+[m[32m  $translate('settings').then(function(translation) {[m
     seoService.setTitle(translation);[m
   });[m
[31m-  $scope.isUnverifiedEmail = function() {[m
[31m-    return $scope.user.verified === 0;[m
[31m-  };[m
[31m-  $scope.resendVerificationEmail = function() {[m
[31m-    userService.verificationEmail($scope.user).then(function(response) {[m
[31m-      $translate('alerts.verification_email_sended').then(function(translation) {[m
[31m-        alertService.addAlert('success', translation);[m
[31m-      });[m
[31m-    }).catch(function(err) {[m
[31m-      translationService.translateError(err).then(function(translation) {[m
[31m-        alertService.addAlert('danger', translation);[m
[31m-      });[m
[31m-    });[m
[31m-  };[m
[31m-  $scope.sampleUsername = function() {[m
[31m-    if(!$scope.user.username || $scope.user.username.length === 0) {[m
[31m-      return '<username>';[m
[31m-    }[m
[31m-    return $scope.user.username.toLowerCase();[m
[31m-  };[m
[31m-  $scope.canEditUsername = function() {[m
[31m-    return Boolean(!$scope.initialUsername);[m
[31m-  };[m
[31m-  $scope.hasProfilePicture = function(network) {[m
[31m-    return userService.hasProfilePicture($scope.user, network);[m
[32m+[m
[32m+[m[32m  $scope.hasNetworkConnection = function(network) {[m
[32m+[m[32m    return userService.hasNetworkConnection($scope.user, network);[m
   };[m
[31m-  $scope.selectProfilePicture = function(network) {[m
[31m-    $scope.user.profile_picture = network;[m
[32m+[m[32m  $scope.selectPrimaryNetwork = function(network) {[m
[32m+[m[32m    $scope.user.primary_network = network;[m
   };[m
[31m-  $scope.isProfilePicture = function(network) {[m
[31m-    return userService.isProfilePicture($scope.user, network);[m
[32m+[m[32m  $scope.isPrimaryNetwork = function(network) {[m
[32m+[m[32m    return userService.isPrimaryNetworkConnection($scope.user, network);[m
   };[m
   $scope.saveChanges = function() {[m
     userService.update($scope.user).then(function(response) {[m
[31m-      $scope.setUser(response.data);[m
       $translate('alerts.changes_saved_successfully').then(function(translation) {[m
         alertService.addAlert('success', translation);[m
       });[m
[36m@@ -108,11 +95,4 @@[m [mangular[m
       });[m
     });[m
   };[m
[31m-}])[m
[31m-.controller('verifyEmailController', ['$state', '$translate', 'alertService', 'authenticationService', function($state, $translate, alertService, authenticationService) {[m
[31m-  authenticationService.updateUser();[m
[31m-  $state.go('app.index');[m
[31m-  $translate('alerts.email_verified').then(function(translation) {[m
[31m-    alertService.addAlert('success', translation);[m
[31m-  });[m
 }]);[m
\ No newline at end of file[m
[1mdiff --git a/public/app/directives/directives.js b/public/app/directives/directives.js[m
[1mindex fc79284..31424bd 100644[m
[1m--- a/public/app/directives/directives.js[m
[1m+++ b/public/app/directives/directives.js[m
[36m@@ -104,4 +104,19 @@[m [mangular[m
       });[m
     }[m
   }[m
[32m+[m[32m}])[m
[32m+[m[32m.directive('passwordCheck', [function () {[m
[32m+[m[32m  return {[m
[32m+[m[32m    restrict: 'A',[m
[32m+[m[32m    require: 'ngModel',[m
[32m+[m[32m    scope: {[m
[32m+[m[32m      password: '=passwordCheck',[m
[32m+[m[32m      passwordConfirmed: '=ngModel'[m
[32m+[m[32m    },[m
[32m+[m[32m    link: function (scope, element, attrs, ctrl) {[m
[32m+[m[32m      scope.$watch('[password, passwordConfirmed]', function(value) {[m
[32m+[m[32m        ctrl.$setValidity('passwordMatch', scope.password === scope.passwordConfirmed);[m
[32m+[m[32m      });[m
[32m+[m[32m    }[m
[32m+[m[32m  }[m
 }]);[m
\ No newline at end of file[m
[1mdiff --git a/public/app/partials/audition.html b/public/app/partials/audition.html[m
[1mindex f732659..6148efa 100644[m
[1m--- a/public/app/partials/audition.html[m
[1m+++ b/public/app/partials/audition.html[m
[36m@@ -28,12 +28,12 @@[m
           {{ 'published' | translate }}[m
           <span am-time-ago="audition.registration_date"></span>[m
           {{ 'by_user' | translate }}[m
[31m-          <a ui-sref="{{ userState(audition.user) }}">{{ audition.user.name }}</a>[m
[32m+[m[32m          <a ui-sref="app.user({locale: locale(), id: audition.user.id})">{{ audition.user.name }}</a>[m
         </p>[m
       </div>[m
     </div>[m
   </div>[m
[31m-  <div ng-if="isContestProgress('running') || isContestProgress('finished')">[m
[32m+[m[32m  <div ng-if="(isContestProgress('running') || isContestProgress('finished')) && isAuditionApproved()">[m
     <div class="row">[m
       <div class="col-md-9">[m
         <div class="row">[m
[36m@@ -46,7 +46,7 @@[m
         <div class="row padding">[m
           <div class="col-md-2">[m
             <div id="author">[m
[31m-              <a ui-sref="{{ userState(audition.user) }}">[m
[32m+[m[32m              <a ui-sref="app.user({locale: locale(), id: audition.user.id})">[m
                 <div profile-picture="audition.user" class="profile-picture">[m
                 </div>[m
               </a>[m
[36m@@ -54,7 +54,7 @@[m
           </div>[m
           <div class="col-md-10">[m
             <h3 class="nomargin">[m
[31m-              <a ui-sref="{{ userState(audition.user) }}">[m
[32m+[m[32m              <a ui-sref="app.user({locale: locale(), id: audition.user.id})">[m
                 {{ audition.user.name }}[m
               </a>[m
             </h3>[m
[36m@@ -102,10 +102,10 @@[m
       </div>[m
     </div>[m
   </div>[m
[31m-  <div ng-if="isContestProgress('waiting') || isContestProgress('waiting_time')">[m
[32m+[m[32m  <div ng-if="isContestProgress('waiting') || isContestProgress('waiting_time') || !isAuditionApproved()">[m
     <div class="row">[m
       <div class="col-md-12">[m
[31m-        <alert type="warning">[m
[32m+[m[32m        <alert ng-if="isAuditionApproved()" type="warning">[m
           <div class="font-biggest">[m
             <p class="nomargin align-center">[m
               {{ 'this_contest_is_not_happening_yet' | translate }}[m
[36m@@ -133,7 +133,7 @@[m
               {{ 'we_need_more_contestants_to_begin_the_contest' | translate: {contestantsRemaining: contestantsRemaining()} }}.[m
             </p>[m
             <div>[m
[31m-              {{ 'help_sharing' | translate }}:[m
[32m+[m[32m              {{ 'help_sharing_on' | translate }}[m
               <a ng-href="http://www.facebook.com/sharer/sharer.php?u={{ siteUrl }}/{{ locale() }}/contest/{{ contest.id }}/{{ contest.slug }}" class="btn btn-social-icon btn-facebook" title="{{ 'share_on' | translate }} Facebook" target="_blank">[m
                 <i class="fa fa-facebook"></i>[m
               </a>[m
[36m@@ -146,6 +146,9 @@[m
             </div>[m
           </div>[m
         </alert>[m
[32m+[m[32m        <alert ng-if="!isAuditionApproved()" type="warning">[m
[32m+[m[32m          <h2 class="align-center">{{ 'this_audition_is_under_review_wait_for_approval' | translate }}</h2>[m
[32m+[m[32m        </alert>[m
       </div>[m
     </div>[m
     <div class="row">[m
[36m@@ -156,32 +159,36 @@[m
       </div>[m
     </div>[m
   </div>[m
[31m-  <div class="row" ng-if="isContestProgress('running') || isContestProgress('waiting') || isContestProgress('waiting_time')">[m
[31m-    <div class="col-md-12">[m
[31m-      <div class="page-title">[m
[31m-        <h3>[m
[31m-          {{ 'latest_auditions' | translate }}[m
[31m-        </h3>[m
[31m-      </div>[m
[31m-      <div class="row" ng-repeat="row in latestAuditions | partition: 4">[m
[31m-        <div ng-repeat="audition in row" class="col-md-3">[m
[31m-          <audition ng-model="audition" locale="{{ locale() }}" show-score="false" thumb-size="small">[m
[31m-          </audition>[m
[32m+[m[32m  <div ng-if="(isContestProgress('running') || isContestProgress('waiting') || isContestProgress('waiting_time')) && hasAuditions(latestAuditions)">[m
[32m+[m[32m    <div class="row">[m
[32m+[m[32m      <div class="col-md-12">[m
[32m+[m[32m        <div class="page-title">[m
[32m+[m[32m          <h3>[m
[32m+[m[32m            {{ 'latest_auditions' | translate }}[m
[32m+[m[32m          </h3>[m
[32m+[m[32m        </div>[m
[32m+[m[32m        <div class="row" ng-repeat="row in latestAuditions | partition: 4">[m
[32m+[m[32m          <div ng-repeat="audition in row" class="col-md-3">[m
[32m+[m[32m            <audition ng-model="audition" locale="{{ locale() }}" show-score="false" thumb-size="small">[m
[32m+[m[32m            </audition>[m
[32m+[m[32m          </div>[m
         </div>[m
       </div>[m
     </div>[m
   </div>[m
[31m-  <div class="row" ng-if="isContestProgress('running') || isContestProgress('finished')">[m
[31m-    <div class="col-md-12">[m
[31m-      <div class="page-title">[m
[31m-        <h3>[m
[31m-          {{ 'best_auditions' | translate }}[m
[31m-        </h3>[m
[31m-      </div>[m
[31m-      <div class="row" ng-repeat="row in bestAuditions | partition: 4">[m
[31m-        <div ng-repeat="audition in row" class="col-md-3">[m
[31m-          <audition ng-model="audition" locale="{{ locale() }}" show-score="false" thumb-size="small">[m
[31m-          </audition>[m
[32m+[m[32m  <div ng-if="(isContestProgress('running') || isContestProgress('finished')) && hasAuditions(bestAuditions)">[m
[32m+[m[32m    <div class="row">[m
[32m+[m[32m      <div class="col-md-12">[m
[32m+[m[32m        <div class="page-title">[m
[32m+[m[32m          <h3>[m
[32m+[m[32m            {{ 'best_auditions' | translate }}[m
[32m+[m[32m          </h3>[m
[32m+[m[32m        </div>[m
[32m+[m[32m        <div class="row" ng-repeat="row in bestAuditions | partition: 4">[m
[32m+[m[32m          <div ng-repeat="audition in row" class="col-md-3">[m
[32m+[m[32m            <audition ng-model="audition" locale="{{ locale() }}" show-score="false" thumb-size="small">[m
[32m+[m[32m            </audition>[m
[32m+[m[32m          </div>[m
         </div>[m
       </div>[m
     </div>[m
[1mdiff --git a/public/app/partials/contact.html b/public/app/partials/contact.html[m
[1mindex 67d8608..d25aef4 100644[m
[1m--- a/public/app/partials/contact.html[m
[1m+++ b/public/app/partials/contact.html[m
[36m@@ -12,7 +12,7 @@[m
             <input ng-model="name" type="text" name="name" class="form-control" placeholder="{{ 'forms.name' | translate }}" required>[m
           </div>[m
           <div class="form-group" ng-class="{'has-error': contactForm.email.$dirty && contactForm.email.$invalid}">[m
[31m-            <input ng-model="email" type="email" name="email" class="form-control" placeholder="{{ 'forms.email' | translate }}" required>[m
[32m+[m[32m            <input ng-model="email" type="email" name="email" class="form-control" placeholder="E-mail" required>[m
           </div>[m
           <div class="form-group" ng-class="{'has-error': contactForm.subject.$dirty && contactForm.subject.$invalid}">[m
             <input ng-model="subject" type="text" name="subject" class="form-control" placeholder="{{ 'forms.subject' | translate }}" required>[m
[1mdiff --git a/public/app/partials/contest.html b/public/app/partials/contest.html[m
[1mindex 850e26c..8bef68f 100644[m
[1m--- a/public/app/partials/contest.html[m
[1m+++ b/public/app/partials/contest.html[m
[36m@@ -122,33 +122,6 @@[m
     </div>[m
   </div>[m
 </div>[m
[31m-<div ng-if="isContestProgress('running') && !hasAuditions()" class="container">[m
[31m-  <div class="jumbotron margin10 align-center">[m
[31m-    <h2>{{ 'be_the_first_to_join_the_contest' | translate }}</h2>[m
[31m-    <div class="padding-top">[m
[31m-      <a ui-sref="app.joinContest({locale: locale(), id: contest.id, slug: contest.slug})" class="btn btn-primary btn-largest">[m
[31m-        {{ 'join_now' | translate }}[m
[31m-      </a>[m
[31m-      <a ui-sref="app.contestGuideline({locale: locale()})" class="btn btn-success btn-largest">[m
[31m-        {{ 'see_the_guideline' | translate }}[m
[31m-      </a>[m
[31m-    </div>[m
[31m-    <h2>[m
[31m-      {{ 'help_sharing' | translate }}[m
[31m-    </h2>[m
[31m-    <div>[m
[31m-      <a ng-href="http://www.facebook.com/sharer/sharer.php?u={{ siteUrl }}/{{ locale() }}/contest/{{ contest.id }}/{{ contest.slug }}" class="btn btn-social-icon btn-facebook btn-lg" title="{{ 'share_on' | translate }} Facebook" target="_blank">[m
[31m-          <i class="fa fa-facebook"></i>[m
[31m-        </a>[m
[31m-      <a ng-href="http://twitter.com/share?url={{ siteUrl }}/{{ locale() }}/contest/{{ contest.id }}/{{ contest.slug }}" class="btn btn-social-icon btn-twitter btn-lg" title="{{ 'share_on' | translate }} Twitter" target="_blank">[m
[31m-        <i class="fa fa-twitter"></i>[m
[31m-      </a>[m
[31m-      <a ng-href="https://plus.google.com/share?url={{ siteUrl }}/{{ locale() }}/contest/{{ contest.id }}/{{ contest.slug }}" class="btn btn-social-icon btn-google-plus btn-lg" title="{{ 'share_on' | translate }} Google+" target="_blank">[m
[31m-        <i class="fa fa-google-plus"></i>[m
[31m-      </a>[m
[31m-    </div>[m
[31m-  </div>[m
[31m-</div>[m
 <div ng-if="isContestProgress('waiting') || isContestProgress('waiting_time')" class="container">[m
   <div class="jumbotron margin10 align-center">[m
     <h2>{{ 'this_contest_is_not_happening_yet' | translate }}</h2>[m
[36m@@ -187,6 +160,9 @@[m
     <div ng-if="isContestant()" class="padding-top">[m
       <a ui-sref="app.audition({locale: locale(), id: audition.id, slug: audition.slug})" class="btn btn-info btn-largest">[m
         {{ 'you_are_participating' | translate }}[m
[32m+[m[32m        <h4 ng-if="!isAuditionApproved()">[m
[32m+[m[32m          {{ 'waiting_for_approval' | translate }}[m
[32m+[m[32m        </h4>[m
       </a>[m
     </div>[m
     <h2>[m
[36m@@ -205,6 +181,67 @@[m
     </div>[m
   </div>[m
 </div>[m
[32m+[m[32m<div ng-if="isContestProgress('waiting') && hasAuditions()" class="container">[m
[32m+[m[32m  <div class="row">[m
[32m+[m[32m    <div class="col-md-8">[m
[32m+[m[32m      <h1>[m
[32m+[m[32m        <span>[m
[32m+[m[32m          {{ 'latest_auditions' | translate }}[m
[32m+[m[32m        </span>[m
[32m+[m[32m        <small>({{ totalAuditions }})</small>[m
[32m+[m[32m      </h1>[m
[32m+[m[32m    </div>[m
[32m+[m[32m  </div>[m
[32m+[m[32m  <div class="row" ng-repeat="row in auditions | partition: 3">[m
[32m+[m[32m    <div ng-repeat="audition in row" class="col-md-4">[m
[32m+[m[32m      <audition ng-model="audition" locale="{{ locale() }}">[m
[32m+[m[32m      </audition>[m
[32m+[m[32m    </div>[m
[32m+[m[32m  </div>[m
[32m+[m[32m  <div class="align-center">[m
[32m+[m[32m    <pagination total-items="totalAuditions" items-per-page="auditionsPerPage" ng-model="currentPage" ng-change="changePage(currentPage)"></pagination>[m
[32m+[m[32m  </div>[m
[32m+[m[32m</div>[m
[32m+[m[32m<div ng-if="isContestProgress('running') && !hasAuditions()" class="container">[m
[32m+[m[32m  <div class="jumbotron margin10 align-center">[m
[32m+[m[32m    <div ng-if="!isContestant()">[m
[32m+[m[32m      <h2>{{ 'be_the_first_to_join_the_contest' | translate }}</h2>[m
[32m+[m[32m      <div class="padding-top">[m
[32m+[m[32m        <a ui-sref="app.joinContest({locale: locale(), id: contest.id, slug: contest.slug})" class="btn btn-primary btn-largest">[m
[32m+[m[32m          {{ 'join_now' | translate }}[m
[32m+[m[32m        </a>[m
[32m+[m[32m        <a ui-sref="app.contestGuideline({locale: locale()})" class="btn btn-success btn-largest">[m
[32m+[m[32m          {{ 'see_the_guideline' | translate }}[m
[32m+[m[32m        </a>[m
[32m+[m[32m      </div>[m
[32m+[m[32m    </div>[m
[32m+[m[32m    <div ng-if="isContestant()">[m
[32m+[m[32m      <h2>{{ 'this_contest_is_happening_but_we_need_contestants' | translate }}</h2>[m
[32m+[m[32m      <div class="padding-top">[m
[32m+[m[32m        <a ui-sref="app.audition({locale: locale(), id: audition.id, slug: audition.slug})" class="btn btn-info btn-largest">[m
[32m+[m[32m          {{ 'you_are_participating' | translate }}[m
[32m+[m[32m          <h4 ng-if="!isAuditionApproved()">[m
[32m+[m[32m            {{ 'waiting_for_approval' | translate }}[m
[32m+[m[32m          </h4>[m
[32m+[m[32m        </a>[m
[32m+[m[32m      </div>[m
[32m+[m[32m    </div>[m
[32m+[m[32m    <h2>[m
[32m+[m[32m      {{ 'help_sharing' | translate }}[m
[32m+[m[32m    </h2>[m
[32m+[m[32m    <div>[m
[32m+[m[32m      <a ng-href="http://www.facebook.com/sharer/sharer.php?u={{ siteUrl }}/{{ locale() }}/contest/{{ contest.id }}/{{ contest.slug }}" class="btn btn-social-icon btn-facebook btn-lg" title="{{ 'share_on' | translate }} Facebook" target="_blank">[m
[32m+[m[32m          <i class="fa fa-facebook"></i>[m
[32m+[m[32m        </a>[m
[32m+[m[32m      <a ng-href="http://twitter.com/share?url={{ siteUrl }}/{{ locale() }}/contest/{{ contest.id }}/{{ contest.slug }}" class="btn btn-social-icon btn-twitter btn-lg" title="{{ 'share_on' | translate }} Twitter" target="_blank">[m
[32m+[m[32m        <i class="fa fa-twitter"></i>[m
[32m+[m[32m      </a>[m
[32m+[m[32m      <a ng-href="https://plus.google.com/share?url={{ siteUrl }}/{{ locale() }}/contest/{{ contest.id }}/{{ contest.slug }}" class="btn btn-social-icon btn-google-plus btn-lg" title="{{ 'share_on' | translate }} Google+" target="_blank">[m
[32m+[m[32m        <i class="fa fa-google-plus"></i>[m
[32m+[m[32m      </a>[m
[32m+[m[32m    </div>[m
[32m+[m[32m  </div>[m
[32m+[m[32m</div>[m
 <div ng-if="isContestProgress('finished')" class="container margin-top">[m
   <h2 class="align-center">{{ 'this_contest_was_finished' | translate }}</h2>[m
   <div ng-if="hasWinners()" ng-repeat="row in winnerAuditions | partition: 3" class="winner row">[m
[36m@@ -215,7 +252,7 @@[m
       <div class="row padding">[m
         <div class="col-md-3">[m
           <div class="winner-author">[m
[31m-            <a ui-sref="{{ userState(audition.user) }}">[m
[32m+[m[32m            <a ui-sref="app.user({locale: locale(), id: audition.user.id})">[m
               <div profile-picture="audition.user" class="profile-picture">[m
               </div>[m
             </a>[m
[36m@@ -223,7 +260,7 @@[m
         </div>[m
         <div class="col-md-9 nopadding-left">[m
           <h4 class="nomargin">[m
[31m-            <a ui-sref="{{ userState(audition.user) }}">[m
[32m+[m[32m            <a ui-sref="app.user({locale: locale(), id: audition.user.id})">[m
               {{ audition.user.name }}[m
             </a>[m
             <span ng-if="isMedal(audition, 'gold')" ng-bind-html="'won_a_gold_medal' | translate">[m
[36m@@ -254,7 +291,7 @@[m
   </div>[m
 </div>[m
 <div ng-if="(isContestProgress('running') || isContestProgress('finished')) && hasAuditions()" class="container">[m
[31m-  <div ng-if="isContestProgress('running') && hasUserVotes()" class="row">[m
[32m+[m[32m  <div ng-if="hasUserVotes()" class="row">[m
     <div class="col-md-12">[m
       <h3>[m
         {{ 'your_votes' | translate }}[m
[36m@@ -304,24 +341,4 @@[m
   <div class="align-center">[m
     <pagination total-items="totalAuditions" items-per-page="auditionsPerPage" ng-model="currentPage" ng-change="changePage(currentPage)"></pagination>[m
   </div>[m
[31m-</div>[m
[31m-<div ng-if="isContestProgress('waiting') && hasAuditions()" class="container">[m
[31m-  <div class="row">[m
[31m-    <div class="col-md-8">[m
[31m-      <h1>[m
[31m-        <span>[m
[31m-          {{ 'latest_auditions' | translate }}[m
[31m-        </span>[m
[31m-        <small>({{ totalAuditions }})</small>[m
[31m-      </h1>[m
[31m-    </div>[m
[31m-  </div>[m
[31m-  <div class="row" ng-repeat="row in auditions | partition: 3">[m
[31m-    <div ng-repeat="audition in row" class="col-md-4">[m
[31m-      <audition ng-model="audition" locale="{{ locale() }}">[m
[31m-      </audition>[m
[31m-    </div>[m
[31m-  </div>[m
[31m-  <div class="align-center">[m
[31m-    <pagination total-items="totalAuditions" items-per-page="auditionsPerPage" ng-model="currentPage" ng-change="changePage(currentPage)"></pagination>[m
[31m-  </div>[m
\ No newline at end of file[m
[32m+[m[32m</div>[m
\ No newline at end of file[m
[1mdiff --git a/public/app/partials/errors/404.html b/public/app/partials/errors/404.html[m
[1mindex fc75f39..d2d36a0 100644[m
[1m--- a/public/app/partials/errors/404.html[m
[1m+++ b/public/app/partials/errors/404.html[m
[36m@@ -1,5 +1,5 @@[m
 <div class="container">[m
   <div class="jumbotron align-center" style="padding-top: 0px;">[m
[31m-    <h1><span class="label label-info">404</span> {{ 'page_not_found' | translate }}</h1>[m
[32m+[m[32m    <h1><span class="label label-info">404</span> {{ 'errors.page_not_found' | translate }}</h1>[m
   </div>[m
 </div>[m
\ No newline at end of file[m
[1mdiff --git a/public/app/partials/errors/500.html b/public/app/partials/errors/500.html[m
[1mindex f4ee3e8..9b0fb3b 100644[m
[1m--- a/public/app/partials/errors/500.html[m
[1m+++ b/public/app/partials/errors/500.html[m
[36m@@ -1,5 +1,5 @@[m
 <div class="container">[m
   <div class="jumbotron align-center" style="padding-top: 0px;">[m
[31m-    <h1><span class="label label-danger">500</span> {{ 'internal_error' | translate }}</h1>[m
[32m+[m[32m    <h1><span class="label label-danger">500</span> {{ 'errors.internal_error' | translate }}</h1>[m
   </div>[m
 </div>[m
\ No newline at end of file[m
[1mdiff --git a/public/app/partials/register.html b/public/app/partials/register.html[m
[1mnew file mode 100644[m
[1mindex 0000000..fbf4814[m
[1m--- /dev/null[m
[1m+++ b/public/app/partials/register.html[m
[36m@@ -0,0 +1,146 @@[m
[32m+[m[32m<div class="container">[m
[32m+[m[32m  <div class="container center-block">[m
[32m+[m[32m    <div class="row">[m
[32m+[m[32m      <div class="align-center">[m
[32m+[m[32m        <img src="/img/logos/green-logo-footer.png">[m
[32m+[m[32m      </div>[m
[32m+[m[32m      <div ng-if="!userRegistered">[m
[32m+[m[32m        <hr/>[m
[32m+[m[32m        <div class="row">[m
[32m+[m[32m          <div class="col-md-4">[m
[32m+[m[32m            <span profile-picture="user" class="img-circle profile-picture pull-right">[m
[32m+[m[32m            </span>[m
[32m+[m[32m          </div>[m
[32m+[m[32m          <div class="col-md-8">[m
[32m+[m[32m            <h2>{{ 'forms.welcome_to' | translate }}</h2>[m
[32m+[m[32m            <h2>[m
[32m+[m[32m              {{ 'forms.you_are_connecting_with' | translate: 'Facebook' }}[m
[32m+[m[32m              <span ng-if="isNetworkConnection('facebook')" class="btn-facebook padding10">[m
[32m+[m[32m                <i class="fa fa-facebook"></i> Facebook[m
[32m+[m[32m              </span>[m
[32m+[m[32m              <span ng-if="isNetworkConnection('twitter')" class="btn-twitter padding10">[m
[32m+[m[32m                <i class="fa fa-twitter"></i> Twitter[m
[32m+[m[32m              </span>[m
[32m+[m[32m              <span ng-if="isNetworkConnection('google')" class="btn-google-plus padding10">[m
[32m+[m[32m                <i class="fa fa-google-plus"></i> Google[m
[32m+[m[32m              </span>[m
[32m+[m[32m            </h2>[m
[32m+[m[32m          </div>[m
[32m+[m[32m        </div>[m
[32m+[m[32m      </div>[m
[32m+[m[32m      <hr/>[m
[32m+[m[32m    </div>[m
[32m+[m[32m    <div class="row">[m
[32m+[m[32m      <form ng-if="!emailChecked" name="checkEmailForm" class="form-horizontal">[m
[32m+[m[32m        <h3 class="align-center">[m
[32m+[m[32m          {{ 'forms.let_us_see_if_we_know_your_email' | translate }}[m
[32m+[m[32m        </h3>[m
[32m+[m[32m        <div class="col-md-4 col-md-offset-4 margin-top">[m
[32m+[m[32m          <div class="form-group" ng-class="{'has-error': checkEmailForm.email.$dirty && checkEmailForm.email.$invalid}">[m
[32m+[m[32m            <input ng-model="user.email" type="email" id="email" name="email" class="form-control" placeholder="Email" required>[m
[32m+[m[32m          </div>[m
[32m+[m[32m          <div class="form-group">[m
[32m+[m[32m            <button ng-disabled="checkEmailForm.$invalid" ng-click="checkEmail()" type="button" class="btn btn-info btn-lg btn-block">{{ 'forms.check_email' | translate }}</button>[m
[32m+[m[32m          </div>[m
[32m+[m[32m        </div>[m
[32m+[m[32m      </form>[m
[32m+[m[32m      <div ng-if="emailChecked && !userRegistered">[m
[32m+[m[32m        <form ng-if="!userFound" name="registerForm" class="form-horizontal">[m
[32m+[m[32m          <h3 class="align-center">[m
[32m+[m[32m            {{ 'forms.we_dont_know_your_email' | translate }}[m
[32m+[m[32m          </h3>[m
[32m+[m[32m          <div class="col-md-6 col-md-offset-3 margin-top">[m
[32m+[m[32m            <div class="form-group">[m
[32m+[m[32m              <label for="email" class="col-md-4">[m
[32m+[m[32m                Email[m
[32m+[m[32m              </label>[m
[32m+[m[32m              <div class="col-md-8">[m
[32m+[m[32m                <input ng-model="user.email" type="email" id="email" name="email" class="form-control" disabled>[m
[32m+[m[32m              </div>[m
[32m+[m[32m            </div>[m
[32m+[m[32m            <div class="form-group">[m
[32m+[m[32m              <label for="name" class="col-md-4">[m
[32m+[m[32m                {{ 'forms.name' | translate }}[m
[32m+[m[32m              </label>[m
[32m+[m[32m              <div class="col-md-8" ng-class="{'has-error': registerForm.name.$dirty && registerForm.name.$invalid}">[m
[32m+[m[32m                <input ng-model="user.name" type="text" id="name" name="name" class="form-control" required>[m
[32m+[m[32m              </div>[m
[32m+[m[32m            </div>[m
[32m+[m[32m            <div class="form-group">[m
[32m+[m[32m              <label for="password" class="col-md-4">[m
[32m+[m[32m                {{ 'forms.password' | translate }}[m
[32m+[m[32m              </label>[m
[32m+[m[32m              <div class="col-md-8" ng-class="{'has-error': registerForm.password.$dirty && registerForm.password.$invalid}">[m
[32m+[m[32m                <input ng-model="user.password" type="password" id="password" name="password" class="form-control" required>[m
[32m+[m[32m                <div ng-password-strength="user.password"></div>[m
[32m+[m[32m              </div>[m
[32m+[m[32m            </div>[m
[32m+[m[32m            <div class="form-group">[m
[32m+[m[32m              <label for="password_confirmed" class="col-md-4">[m
[32m+[m[32m                {{ 'forms.confirm_your_password' | translate }}[m
[32m+[m[32m              </label>[m
[32m+[m[32m              <div class="col-md-8" ng-class="{'has-error': registerForm.password_confirmed.$dirty && registerForm.password_confirmed.$invalid}">[m
[32m+[m[32m                <input ng-model="password_confirmed" type="password" id="password_confirmed" name="password_confirmed" class="form-control" required password-check="user.password">[m
[32m+[m[32m              </div>[m
[32m+[m[32m            </div>[m
[32m+[m[32m            <div class="form-group">[m
[32m+[m[32m              <button ng-disabled="registerForm.$invalid" ng-click="register()" type="button" class="btn btn-primary btn-lg btn-block">{{ 'forms.register' | translate }}</button>[m
[32m+[m[32m            </div>[m
[32m+[m[32m          </div>[m
[32m+[m[32m        </form>[m
[32m+[m[32m        <form ng-if="userFound" name="confirmForm" class="form-horizontal">[m
[32m+[m[32m          <h3 class="align-center">[m
[32m+[m[32m            {{ 'forms.ok_we_know_your_email' | translate: {user: userFound.name} }}[m
[32m+[m[32m          </h3>[m
[32m+[m[32m          <div class="col-md-6 col-md-offset-3 margin-top">[m
[32m+[m[32m            <div class="form-group">[m
[32m+[m[32m              <label for="email" class="col-md-4">[m
[32m+[m[32m                Email[m
[32m+[m[32m              </label>[m
[32m+[m[32m              <div class="col-md-8">[m
[32m+[m[32m                <input ng-model="userFound.email" type="email" id="email" name="email" class="form-control" disabled>[m
[32m+[m[32m              </div>[m
[32m+[m[32m            </div>[m
[32m+[m[32m            <div class="form-group">[m
[32m+[m[32m              <label for="password" class="col-md-4">[m
[32m+[m[32m                {{ 'forms.password' | translate }}[m
[32m+[m[32m              </label>[m
[32m+[m[32m              <div class="col-md-8" ng-class="{'has-error': confirmForm.password.$dirty && confirmForm.password.$invalid}">[m
[32m+[m[32m                <input ng-model="userFound.password" type="password" id="password" name="password" class="form-control" required>[m
[32m+[m[32m              </div>[m
[32m+[m[32m            </div>[m
[32m+[m[32m            <div class="form-group">[m
[32m+[m[32m              <button ng-disabled="confirmForm.$invalid" ng-click="confirm()" type="button" class="btn btn-primary btn-lg btn-block">{{ 'forms.confirm' | translate }}</button>[m
[32m+[m[32m            </div>[m
[32m+[m[32m          </div>[m
[32m+[m[32m        </form>[m
[32m+[m[32m      </div>[m
[32m+[m[32m      <div ng-if="userRegistered" class="align-center">[m
[32m+[m[32m        <h2>{{ 'forms.thank_you' | translate: {user: user.name} }}[m
[32m+[m[32m        <h3>[m
[32m+[m[32m          {{ 'forms.now_you_are_connected_with' | translate }}[m
[32m+[m[32m          <span ng-if="isNetworkConnection('facebook')" class="btn-facebook padding10">[m
[32m+[m[32m            <i class="fa fa-facebook"></i> Facebook[m
[32m+[m[32m          </span>[m
[32m+[m[32m          <span ng-if="isNetworkConnection('twitter')" class="btn-twitter padding10">[m
[32m+[m[32m            <i class="fa fa-twitter"></i> Twitter[m
[32m+[m[32m          </span>[m
[32m+[m[32m          <span ng-if="isNetworkConnection('google')" class="btn-google-plus padding10">[m
[32m+[m[32m            <i class="fa fa-google-plus"></i> Google[m
[32m+[m[32m          </span>[m
[32m+[m[32m        </h3>[m
[32m+[m[32m        <div class="jumbotron">[m
[32m+[m[32m          <div ng-if="previousState">[m
[32m+[m[32m            <h2>{{ 'forms.wait_a_moment_you_will_be_redirected' | translate }}</h2>[m
[32m+[m[32m            <h2>{{ 'or' | translate }}</h2>[m
[32m+[m[32m          </div>[m
[32m+[m[32m          <h2>[m
[32m+[m[32m            <a ui-sref="app.user({locale: locale(), id: user.id})">[m
[32m+[m[32m              {{ 'forms.click_here_to_see_your_profile' | translate }}[m
[32m+[m[32m            </a>[m
[32m+[m[32m          </h2>[m
[32m+[m[32m        </div>[m
[32m+[m[32m      </div>[m
[32m+[m[32m    </div>[m
[32m+[m[32m  </div>[m
[32m+[m[32m</div>[m
\ No newline at end of file[m
[1mdiff --git a/public/app/partials/settings.html b/public/app/partials/settings.html[m
[1mindex 0d91290..90238c2 100644[m
[1m--- a/public/app/partials/settings.html[m
[1m+++ b/public/app/partials/settings.html[m
[36m@@ -14,34 +14,6 @@[m
               </div>[m
             </div>[m
             <div class="form-group">[m
[31m-              <label for="username" class="control-label col-md-2">[m
[31m-                {{ 'forms.username' | translate }}[m
[31m-              </label>[m
[31m-              <div class="col-md-6">[m
[31m-                <input ng-model="user.username" ng-disabled="!canEditUsername()" type="text" id="username" name="username" class="form-control" placeholder="{{ 'forms.username' | translate }}">[m
[31m-                <span class="help-block">[m
[31m-                  {{ 'forms.username_first_help' | translate }} {{ siteUrl }}/{{ locale() }}/user/{{ sampleUsername() }}[m
[31m-                </span>[m
[31m-                <span class="help-block" ng-if="canEditUsername()">[m
[31m-                  {{ 'forms.edit_username_help' | translate }}[m
[31m-                </span>[m
[31m-              </div>[m
[31m-            </div>[m
[31m-            <div class="form-group">[m
[31m-              <label for="email" class="control-label col-md-2">[m
[31m-                {{ 'forms.email' | translate }}[m
[31m-              </label>[m
[31m-              <div class="col-md-6" ng-class="{'has-error': profileForm.email.$dirty && profileForm.email.$invalid}">[m
[31m-                <input ng-model="user.email" type="text" id="email" name="email" class="form-control" placeholder="{{ 'forms.email' | translate }}" required>[m
[31m-                <span ng-if="isUnverifiedEmail()" class="help-block align-right font-normal">[m
[31m-                  <a ng-click="resendVerificationEmail()">{{ 'forms.resend_verification_email' | translate }}</a>[m
[31m-                </span>[m
[31m-                <span class="help-block">[m
[31m-                  {{ 'forms.edit_email_help' | translate }}[m
[31m-                </span>[m
[31m-              </div>[m
[31m-            </div>[m
[31m-            <div class="form-group">[m
               <label for="gender" class="control-label col-md-2">[m
                 {{ 'forms.gender' | translate }}[m
               </label>[m
[36m@@ -68,7 +40,7 @@[m
                 {{ 'forms.biography' | translate }}[m
               </label>[m
               <div class="col-md-6">[m
[31m-                <textarea ng-model="user.biography" id="biography" name="biography" class="form-control" rows="5" placeholder="{{ 'forms.write_something_about_you' | translate }}">[m
[32m+[m[32m                <textarea ng-model="user.biography" id="biography" name="biography" class="form-control" rows="5" placeholder="{{ 'forms.write_something_about_your_passion_for_music' | translate }}">[m
                 </textarea>[m
               </div>[m
             </div>[m
[36m@@ -77,25 +49,25 @@[m
                 {{ 'forms.picture' | translate }}[m
               </label>[m
               <div id="primary-pictures" class="col-md-10">[m
[31m-                <div class="thumbnail pull-left" ng-if="hasProfilePicture('facebook')" ng-click="selectProfilePicture('facebook')" ng-class="{selected: isProfilePicture('facebook')}">[m
[32m+[m[32m                <div class="thumbnail pull-left" ng-if="hasNetworkConnection('facebook')" ng-click="selectPrimaryNetwork('facebook')" ng-class="{selected: isPrimaryNetwork('facebook')}">[m
                   <div profile-picture="user" network="facebook" class="profile-picture img-circle align-center">[m
                   </div>[m
                   <div class="caption align-center">[m
[31m-                    <i ng-show="isProfilePicture('facebook')" class="glyphicon glyphicon-ok"></i> {{ 'forms.use_facebook_picture' | translate }}[m
[32m+[m[32m                    <i ng-show="isPrimaryNetwork('facebook')" class="glyphicon glyphicon-ok"></i> {{ 'forms.use_facebook_picture' | translate }}[m
                   </div>[m
                 </div>[m
[31m-                <div class="thumbnail pull-left" ng-if="hasProfilePicture('twitter')" ng-click="selectProfilePicture('twitter')" ng-class="{selected: isProfilePicture('twitter')}">[m
[32m+[m[32m                <div class="thumbnail pull-left" ng-if="hasNetworkConnection('twitter')" ng-click="selectPrimaryNetwork('twitter')" ng-class="{selected: isPrimaryNetwork('twitter')}">[m
                   <div profile-picture="user" network="twitter" class="profile-picture img-circle align-center">[m
                   </div>[m
                   <div class="caption align-center">[m
[31m-                    <i ng-show="isProfilePicture('twitter')" class="glyphicon glyphicon-ok"></i> {{ 'forms.use_twitter_picture' | translate }}[m
[32m+[m[32m                    <i ng-show="isPrimaryNetwork('twitter')" class="glyphicon glyphicon-ok"></i> {{ 'forms.use_twitter_picture' | translate }}[m
                   </div>[m
                 </div>[m
[31m-                <div class="thumbnail pull-left" ng-if="hasProfilePicture('google')" ng-click="selectProfilePicture('google')" ng-class="{selected: isProfilePicture('google')}">[m
[32m+[m[32m                <div class="thumbnail pull-left" ng-if="hasNetworkConnection('google')" ng-click="selectPrimaryNetwork('google')" ng-class="{selected: isPrimaryNetwork('google')}">[m
                   <div profile-picture="user" network="google" class="profile-picture img-circle align-center">[m
                   </div>[m
                   <div class="caption align-center">[m
[31m-                    <i ng-show="isProfilePicture('google')" class="glyphicon glyphicon-ok"></i> {{ 'forms.use_google_picture' | translate }}[m
[32m+[m[32m                    <i ng-show="isPrimaryNetwork('google')" class="glyphicon glyphicon-ok"></i> {{ 'forms.use_google_picture' | translate }}[m
                   </div>[m
                 </div>[m
               </div>[m
[1mdiff --git a/public/app/partials/user.html b/public/app/partials/user.html[m
[1mindex 4c97e62..53ee4ec 100644[m
[1m--- a/public/app/partials/user.html[m
[1m+++ b/public/app/partials/user.html[m
[36m@@ -3,7 +3,7 @@[m
     <div class="container">[m
       <div class="row">[m
         <div class="col-md-3">[m
[31m-          <a ui-sref="{{ userState(user) }}">[m
[32m+[m[32m          <a ui-sref="app.user({locale: locale(), id: user.id})">[m
             <div profile-picture="user" class="profile-picture img-circle">[m
             </div>[m
           </a>[m
[1mdiff --git a/public/app/partials/verify.html b/public/app/partials/verify.html[m
[1mdeleted file mode 100644[m
[1mindex e69de29..0000000[m
[1mdiff --git a/public/app/partials/widgets/login-modal.html b/public/app/partials/widgets/login-modal.html[m
[1mindex 9a224a9..4ab8248 100644[m
[1m--- a/public/app/partials/widgets/login-modal.html[m
[1m+++ b/public/app/partials/widgets/login-modal.html[m
[36m@@ -1,5 +1,5 @@[m
 <div class="modal-header">[m
[31m-  <button ng-click="cancel()" type="button" class="close" aria-hidden="true">[m
[32m+[m[32m  <button ng-click="modalScope.close()" type="button" class="close" aria-hidden="true">[m
     &times;[m
   </button>[m
   <h3 class="align-center">{{ 'signin_message' | translate }}</h3>[m
[36m@@ -7,9 +7,23 @@[m
 <div class="modal-body">[m
   <div class="row margin10">[m
     <div class="col-md-12">[m
[31m-      <a ng-click="login('facebook');" class="btn btn-lg btn-block btn-social btn-facebook">[m
[32m+[m[32m      <a ng-click="modalScope.auth('facebook');" class="btn btn-lg btn-block btn-social btn-facebook">[m
         <i class="fa fa-facebook"></i> Facebook[m
       </a>[m
     </div>[m
   </div>[m
[32m+[m[32m  <!-- <div class="row margin10">[m
[32m+[m[32m    <div class="col-md-12">[m
[32m+[m[32m      <a ng-click="modalScope.auth('twitter');" class="btn btn-lg btn-block btn-social btn-twitter">[m
[32m+[m[32m        <i class="fa fa-twitter"></i> Twitter[m
[32m+[m[32m      </a>[m
[32m+[m[32m    </div>[m
[32m+[m[32m  </div> -->[m
[32m+[m[32m  <!-- <div class="row margin10">[m
[32m+[m[32m    <div class="col-md-12">[m
[32m+[m[32m      <a ng-click="modalScope.auth('google');" class="btn btn-lg btn-block btn-social btn-google-plus">[m
[32m+[m[32m        <i class="fa fa-google-plus"></i> Google[m
[32m+[m[32m      </a>[m
[32m+[m[32m    </div>[m
[32m+[m[32m  </div> -->[m
 </div>[m
\ No newline at end of file[m
[1mdiff --git a/public/app/partials/widgets/register-modal.html b/public/app/partials/widgets/register-modal.html[m
[1mindex 6f26d5e..cd2fb7b 100644[m
[1m--- a/public/app/partials/widgets/register-modal.html[m
[1m+++ b/public/app/partials/widgets/register-modal.html[m
[36m@@ -59,7 +59,7 @@[m
           <div class="col-md-9" ng-class="{'has-error': registerForm.username.$dirty && registerForm.username.$invalid}">[m
             <input ng-model="temporaryUser.username" type="text" id="username" name="username" class="form-control">[m
             <span class="help-block">[m
[31m-              {{ 'forms.username_first_help' | translate }} {{ siteUrl }}/{{ locale }}/user/{{ sampleUsername() }}[m
[32m+[m[32m              {{ 'forms.username_first_help' | translate }} <b>{{ siteUrl }}/{{ locale }}/{{ sampleUsername() }}</b>[m
             </span>[m
             <span class="help-block">[m
               <alert type="warning">[m
[1mdiff --git a/public/app/providers/providers.js b/public/app/providers/providers.js[m
[1mindex 7df2aa8..0ce47aa 100644[m
[1m--- a/public/app/providers/providers.js[m
[1m+++ b/public/app/providers/providers.js[m
[36m@@ -19,9 +19,9 @@[m [mangular[m
       by: 'By',[m
       by_lowercase: 'by',[m
       by_user: 'by',[m
[31m-      contest_finished: 'Contest finished',[m
       cover_by: 'Cover by',[m
       cover_video_title: '{{ author }}\'s cover of "{{ music.title }}" by {{ artist.name }}',[m
[32m+[m[32m      contest_finished: 'Contest finished',[m
       days: 'days',[m
       edit_profile: 'Edit profile',[m
       first_place: '1st Place',[m
[36m@@ -29,11 +29,11 @@[m [mangular[m
       give_us_your_feedback: 'Give us your Feedback',[m
       help_us_to_improve: 'Help us to further improve Cover Academy',[m
       help_sharing: 'Help sharing',[m
[32m+[m[32m      help_sharing_on: 'Help sharing on',[m
       hours: 'hours',[m
       indicate_cover: 'Do you know an amazing cover song?',[m
       indicate_cover_steps: 'Visit our Facebook page and leave us a message',[m
       informations_saved_successfully: 'Informations saved successfully',[m
[31m-      internal_error: 'Internal error',[m
       join_contest: 'Join contest',[m
       join_contest_signin_account: 'Sign in with your account to join the contest',[m
       join_contest_signin_youtube_account_title: 'Is this your first time?',[m
[36m@@ -52,7 +52,6 @@[m [mangular[m
       musics: 'musics',[m
       on_youtube: 'on YouTube',[m
       or: 'or',[m
[31m-      page_not_found: 'Page not found',[m
       paste_here_the_video_url: 'Paste here the video URL',[m
       please_dont_share_this_audition_yet: 'Please dont share this audition yet',[m
       points: 'points',[m
[36m@@ -74,7 +73,7 @@[m [mangular[m
       see_the_prizes: 'See the prizes',[m
       share_on: 'Share on',[m
       share_this_contest: 'Share this contest',[m
[31m-      signin_message: 'Please sign in with your Facebook account',[m
[32m+[m[32m      signin_message: 'Please sign in with your social network account',[m
       signin_with: 'Sign in with',[m
       the_artist_or_band_name: 'The artist or band name',[m
       the_audition_description: 'Write something interesting about your video',[m
[36m@@ -86,6 +85,8 @@[m [mangular[m
       the_publish_date_must_be_since: 'Remember, the publish date of the video on YouTube should be since',[m
       third_place: '3rd Place',[m
       third_place_description: 'The author of the audition with the third highest score at the end of the contest will win 3rd place. The prize money will grow with every new singer entry.',[m
[32m+[m[32m      this_audition_is_under_review_wait_for_approval: 'This audition is under review, wait for approval.',[m
[32m+[m[32m      this_contest_is_happening_but_we_need_contestants: 'This contest is happening but we need contestants!',[m
       this_contest_is_not_happening_yet: 'This contest is not happening yet!',[m
       this_contest_was_finished: 'This contest was finished!',[m
       time_remaining_to_start: 'Remaining time to start',[m
[36m@@ -93,6 +94,7 @@[m [mangular[m
       vote_now: 'Vote now!',[m
       votes: 'votes',[m
       voting_power: 'Voting power',[m
[32m+[m[32m      waiting_for_approval: 'Waiting for approval',[m
       watch_the_audition: 'Watch the audition',[m
       watch_your_audition: 'Watch your audition',[m
       we_need_more_contestants_to_begin_the_contest: 'We need {{ contestantsRemaining }} more contestants to begin the contest',[m
[36m@@ -107,29 +109,28 @@[m [mangular[m
       your_audition: 'Your audition',[m
       your_votes: 'Your votes',[m
       alerts: {[m
[31m-        changes_saved_successfully: 'Changes saved successfully.',[m
[32m+[m[32m        changes_saved_successfully: 'Changes saved successfully',[m
         congratulations_now_you_are_in_the_contest: 'Congratulations, now you are in the contest. Good luck!',[m
[31m-        email_verified: 'Your email was verified successfully, now you can vote and enter the contest.',[m
[31m-        login_failed: 'Error authenticating, please try again.',[m
[31m-        login_success: 'You are authenticated now.',[m
[31m-        not_authenticated: 'You are trying to access an privileged section, please sign in with your social account.',[m
[31m-        not_authorized: 'You are not authorized to access this section.',[m
[31m-        thank_you_for_voting: 'Thank you for voting, help {{ user }} to win the contest by sharing this page.',[m
[31m-        verification_email_sended: 'Verificaiton email sended successfully.'[m
[32m+[m[32m        login_failed: 'Error authenticating, please try again!',[m
[32m+[m[32m        login_success: 'You are authenticated now!',[m
[32m+[m[32m        not_authenticated: 'You are trying to access an privileged section, please sign in with your social account!',[m
[32m+[m[32m        not_authorized: 'You are not authorized to access this section!',[m
[32m+[m[32m        thank_you_for_voting: 'Thank you for voting, help {{ user }} to win the contest by sharing this page!'[m
       },[m
       errors: {[m
[31m-        authentication_required: 'You are not logged in, please sign in with your account to continue.',[m
[32m+[m[32m        authentication_required: 'You are not logged in, please sign in with your account to continue',[m
[32m+[m[32m        page_not_found: 'Page not found',[m
[32m+[m[32m        internal_error: 'Internal error',[m
         join_contest_already_finished: 'The contest was already finished =(',[m
[31m-        join_contest_video_date_is_not_valid: 'The date of the video must be between the dates of acceptance of the videos and the contest end date.',[m
[31m-        join_contest_video_not_owned_by_user: 'You can not join the contest using a video that are not owned by you.',[m
[31m-        join_contest_user_already_in_contest: 'You are already participating in this contest. For questions please contact us.',[m
[31m-        unexpected_error: 'An unexpected error happened, please try again later.',[m
[31m-        user_edit_invalid_username: 'The username can only contain alphanumeric characters (a-z, 0-9) or a period ("."), with at least 5 characters and maximum length of 20.',[m
[31m-        user_verification_email_already_verified: 'Your email was already verified.',[m
[31m-        user_verification_error_sending_verification_email: 'Error sending verification email, please try again later.',[m
[31m-        user_vote_can_not_vote_for_yourself: 'You can not vote for yourself.',[m
[31m-        user_vote_contest_was_finished: 'You can\'t vote because this contest was already finished.',[m
[31m-        user_vote_reach_vote_limit: 'You reach the maximum of votes per contest.',[m
[32m+[m[32m        join_contest_video_date_is_not_valid: 'The video can not be older or younger than the contest',[m
[32m+[m[32m        join_contest_video_not_owned_by_user: 'You can not join the contest using a video that are not owned by you',[m
[32m+[m[32m        join_contest_user_already_in_contest: 'You are already participating in this contest. For questions please contact us',[m
[32m+[m[32m        unexpected_error: 'An unexpected error happened, please try again later',[m
[32m+[m[32m        user_auth_account_not_found: 'Account not found, please check your email and password',[m
[32m+[m[32m        user_auth_password_with_fewer_characteres: 'The password must contains at least 6 characteres',[m
[32m+[m[32m        user_vote_can_not_vote_for_yourself: 'You can not vote for yourself',[m
[32m+[m[32m        user_vote_contest_was_finished: 'You can\'t vote because this contest was already finished',[m
[32m+[m[32m        user_vote_reach_vote_limit: 'You reach the maximum of votes per contest',[m
         youtube_video_url_not_valid: 'For now we support only Youtube videos =('[m
       },[m
       forms: {[m
[36m@@ -139,23 +140,21 @@[m [mangular[m
         city: 'City',[m
         click_here_to_see_your_profile: 'Click here to see your profile',[m
         confirm: 'Confirm',[m
[31m-        edit_email_help: 'If you change this email, we will send you a verification email and you can only use the main features after verify your email again.',[m
[31m-        edit_username_help: 'This name can be defined only once. If you fill now, you can not change later.',[m
[31m-        email: 'Email',[m
[31m-        email_help: 'Want to use this email to receive our updates? If you choose another, we will send you a verification email and you can only use the main features after verify your email.',[m
[31m-        email_sended: 'Email sended successfully, please wait for our contact',[m
[32m+[m[32m        confirm_your_password: 'Confirm your password',[m
[32m+[m[32m        email_sended: 'E-mail sended successfully, please wait for our contact',[m
         error_sending_email: 'Error sending the e-mail, please try again lately',[m
         female: 'Female',[m
         gender: 'Gender',[m
[32m+[m[32m        let_us_see_if_we_know_your_email: 'Let us see if we know your email.',[m
         location: 'Location',[m
         male: 'Male',[m
         message: 'Message',[m
         name: 'Name',[m
         now_you_are_connected_with: 'Now you are connected with',[m
[31m-        optional: 'optional',[m
[32m+[m[32m        ok_we_know_your_email: 'Ok {{ user }}, we know your email. Please confirm with your password.',[m
[32m+[m[32m        password: 'Password',[m
         picture: 'Picture',[m
[31m-        please_confirm_some_informations_about_your_account: 'Please confirm some informations about your account',[m
[31m-        resend_verification_email: 'The verification email has not arrived yet? Send again!',[m
[32m+[m[32m        register: 'Register',[m
         save: 'Save',[m
         save_changes: 'Save changes',[m
         state: 'State',[m
[36m@@ -165,14 +164,12 @@[m [mangular[m
         use_facebook_picture: 'Use Facebook picture',[m
         use_google_picture: 'Use Google picture',[m
         use_twitter_picture: 'Use Twitter picture',[m
[31m-        username: 'Username',[m
[31m-        username_first_help: 'Users will find your profile page this way:',[m
[31m-        username_second_help: 'This name can be defined only once. If you fill now, you can not change later. Otherwise, just access your account settings.',[m
         wait_a_moment_you_will_be_redirected: 'Wait a moment, you will be redirected to where you were in 10 seconds',[m
[32m+[m[32m        we_dont_know_your_email: 'We don\'t know your email, please continue with your registration.',[m
         welcome_to: 'Welcome to Cover Academy',[m
         what_is_your_name: 'What is your name?',[m
         where_are_you: 'Where are you?',[m
[31m-        write_something_about_you: 'Write something about you',[m
[32m+[m[32m        write_something_about_your_passion_for_music: 'Write something about your passion for music',[m
         you_are_connecting_with: 'You are connecting with'[m
       },[m
       menus: {[m
[36m@@ -218,8 +215,6 @@[m [mangular[m
           cover: '{{ author }}\'s cover of "{{ music }}" by {{ artist }}',[m
           covers: 'The best covers in one place',[m
           covers_rank: 'The {{ rankType }} covers from this week',[m
[31m-          error_404: 'Page not found',[m
[31m-          error_500: 'Internal error',[m
           guideline: 'Read our contest guideline and find out how to participate!',[m
           index: 'Join our music contest now!',[m
           join_contest: 'Join the contest now!',[m
[36m@@ -228,7 +223,6 @@[m [mangular[m
           music_genre_rank: 'The {{ rankType }} {{ musicGenre }} cover songs',[m
           privacy_policy: 'Privacy policy',[m
           search: 'Search results for "{{ searchQuery }}"',[m
[31m-          settings: 'Settings',[m
           terms_of_use: 'Terms of use'[m
         },[m
         description: {[m
[36m@@ -262,9 +256,9 @@[m [mangular[m
       by: 'Por',[m
       by_lowercase: 'de',[m
       by_user: 'por',[m
[31m-      contest_finished: 'Competição finalizada',[m
       cover_by: 'Cover de',[m
       cover_video_title: 'Cover de {{ author }} da música "{{ music.title }}" de {{ artist.name }}',[m
[32m+[m[32m      contest_finished: 'Competição finalizada',[m
       days: 'dias',[m
       edit_profile: 'Editar perfil',[m
       first_place: 'Primeiro lugar',[m
[36m@@ -272,11 +266,11 @@[m [mangular[m
       give_us_your_feedback: 'Nos dê o seu Feedback',[m
       help_us_to_improve: 'Ajude-nos a melhorar ainda mais o Cover Academy',[m
       help_sharing: 'Ajude compartilhando',[m
[32m+[m[32m      help_sharing_on: 'Ajude compartilhando no',[m
       hours: 'horas',[m
       indicate_cover: 'Você conhece um cover incrível?',[m
       indicate_cover_steps: 'Visite a nossa página no Facebook e nos deixe uma mensagem',[m
       informations_saved_successfully: 'Informações foram salvas com sucesso',[m
[31m-      internal_error: 'Erro interno',[m
       join_contest: 'Entrar na competição',[m
       join_contest_signin_account: 'Acesse sua conta para poder entrar na competição',[m
       join_contest_signin_youtube_account_title: 'Essa é a sua primeira vez?',[m
[36m@@ -295,7 +289,6 @@[m [mangular[m
       musics: 'músicas',[m
       on_youtube: 'no YouTube',[m
       or: 'ou',[m
[31m-      page_not_found: 'Página não encontrada',[m
       paste_here_the_video_url: 'Cole aqui a URL do vídeo',[m
       please_dont_share_this_audition_yet: 'Por favor, ainda não compartilhe esta apresentação',[m
       points: 'pontos',[m
[36m@@ -317,7 +310,7 @@[m [mangular[m
       see_the_prizes: 'Veja os prêmios',[m
       share_on: 'Compartilhe no',[m
       share_this_contest: 'Compartilhe esta competição',[m
[31m-      signin_message: 'Por favor acesse com sua conta do Facebook',[m
[32m+[m[32m      signin_message: 'Por favor acesse com sua conta de rede social',[m
       signin_with: 'Acessar com',[m
       the_artist_or_band_name: 'O nome do artista ou da banda',[m
       the_audition_description: 'Escreva algo interessante sobre seu vídeo',[m
[36m@@ -329,6 +322,8 @@[m [mangular[m
       the_publish_date_must_be_since: 'Lembre-se, a data de publicação do vídeo no YouTube deve ser a partir de',[m
       third_place: 'Terceiro lugar',[m
       third_place_description: 'O autor da audição com a terceira maior pontuação no final do concurso vencerá em terceiro lugar. O prêmio em dinheiro aumentará com a entrada de novos competidores.',[m
[32m+[m[32m      this_audition_is_under_review_wait_for_approval: 'Está audição está sob revisão, espere pela aprovação.',[m
[32m+[m[32m      this_contest_is_happening_but_we_need_contestants: 'Esta competição está acontecendo, mas precisamos de competidores!',[m
       this_contest_is_not_happening_yet: 'Esta competição ainda não está acontecendo!',[m
       this_contest_was_finished: 'Esta competição acabou!',[m
       time_remaining_to_start: 'Tempo restante para iniciar',[m
[36m@@ -336,6 +331,7 @@[m [mangular[m
       vote_now: 'Vote agora!',[m
       votes: 'votos',[m
       voting_power: 'Poder de voto',[m
[32m+[m[32m      waiting_for_approval: 'Aguardando aprovação',[m
       watch_the_audition: 'Assista ao vídeo',[m
       watch_your_audition: 'Assista ao seu vídeo',[m
       we_need_more_contestants_to_begin_the_contest: 'Precisamos de mais {{ contestantsRemaining }} participantes para iniciar a competição',[m
[36m@@ -350,29 +346,28 @@[m [mangular[m
       your_audition: 'Sua audição',[m
       your_votes: 'Seus votos',[m
       alerts: {[m
[31m-        changes_saved_successfully: 'Alterações atualizadas com sucesso.',[m
[32m+[m[32m        changes_saved_successfully: 'Alterações atualizadas com sucesso',[m
         congratulations_now_you_are_in_the_contest: 'Parabéns, agora você está participando da competição. Boa sorte!',[m
[31m-        email_verified: 'Seu email foi verificado com sucesso, agora você pode votar e participar da competição.',[m
[31m-        login_failed: 'Erro ao autenticar, por favor tente novamente.',[m
[31m-        login_success: 'Você está autenticado agora.',[m
[31m-        not_authenticated: 'Você está tentando acessar uma seção privilegiada, por favor acesse sua conta de rede social.',[m
[31m-        not_authorized: 'Você não tem autorização para acessar esta seção.',[m
[31m-        thank_you_for_voting: 'Obrigado pelo seu voto, ajude {{ user }} a vencer a competição compartilhando esta página.',[m
[31m-        verification_email_sended: 'Email de verificação enviado com sucesso.'[m
[32m+[m[32m        login_failed: 'Erro ao autenticar, por favor tente novamente!',[m
[32m+[m[32m        login_success: 'Você está autenticado agora!',[m
[32m+[m[32m        not_authenticated: 'Você está tentando acessar uma seção privilegiada, por favor acesse sua conta de rede social!',[m
[32m+[m[32m        not_authorized: 'Você não tem autorização para acessar esta seção!',[m
[32m+[m[32m        thank_you_for_voting: 'Obrigado pelo seu voto, ajude {{ user }} a vencer a competição compartilhando esta página!'[m
       },[m
       errors: {[m
[31m-        authentication_required: 'Você não está logado, por favor acesse sua conta para continuar.',[m
[32m+[m[32m        authentication_required: 'Você não está logado, por favor acesse sua conta para continuar',[m
[32m+[m[32m        page_not_found: 'Página não encontrada',[m
[32m+[m[32m        internal_error: 'Erro interno',[m
         join_contest_already_finished: 'A competição já foi finalizada =(',[m
[31m-        join_contest_video_date_is_not_valid: 'A data do vídeo deve estar entre as datas de aceitação de vídeos e a data de término da competição.',[m
[31m-        join_contest_video_not_owned_by_user: 'Você não pode participar de uma competição com um vídeo publicado em outra conta.',[m
[31m-        join_contest_user_already_in_contest: 'Você já está participando dessa competição. Caso tenha dúvidas entre em contato.',[m
[31m-        unexpected_error: 'Um erro inesperado ocorreu, por favor tente novamente.',[m
[31m-        user_edit_invalid_username: 'O username só pode conter caracteres alfanuméricos (a-z, 0-9) ou ponto ".", com no mínimo 5 e no máximo 20 caracteres.',[m
[31m-        user_verification_email_already_verified: 'Seu email já foi verificado.',[m
[31m-        user_verification_error_sending_verification_email: 'Erro ao enviar email de confirmação, por favor tente novamente mais tarde.',[m
[31m-        user_vote_can_not_vote_for_yourself: 'Você não pode votar em si mesmo.',[m
[31m-        user_vote_contest_was_finished: 'Você não pode votar porque esta competição já foi finalizado.',[m
[31m-        user_vote_reach_vote_limit: 'Você alcançou o máximo de votos por competição.',[m
[32m+[m[32m        join_contest_video_date_is_not_valid: 'O vídeo não pode ser mais antigo ou mais novo que a competição',[m
[32m+[m[32m        join_contest_video_not_owned_by_user: 'Você não pode participar de uma competição com um vídeo publicado em outra conta',[m
[32m+[m[32m        join_contest_user_already_in_contest: 'Você já está participando dessa competição. Caso tenha dúvidas entre em contato',[m
[32m+[m[32m        unexpected_error: 'Um erro inesperado ocorreu, por favor tente novamente',[m
[32m+[m[32m        user_auth_account_not_found: 'Conta não encontrada, por favor verifique seu email e senha',[m
[32m+[m[32m        user_auth_password_with_fewer_characteres: 'A senha deve conter no mínimo 6 caracteres',[m
[32m+[m[32m        user_vote_can_not_vote_for_yourself: 'Você não pode votar em si mesmo',[m
[32m+[m[32m        user_vote_contest_was_finished: 'Você não pode votar porque esta competição já foi finalizado',[m
[32m+[m[32m        user_vote_reach_vote_limit: 'Você alcançou o máximo de votos por competição',[m
         youtube_video_url_not_valid: 'Por enquanto suportamos apenas vídeos do YouTube =('[m
       },[m
       forms: {[m
[36m@@ -382,23 +377,21 @@[m [mangular[m
         city: 'Cidade',[m
         click_here_to_see_your_profile: 'Clique aqui para ver o seu perfil',[m
         confirm: 'Confirmar',[m
[31m-        edit_email_help: 'Se você alterar este email, nós enviaremos um email de verificação e você só poderá utilizar as principais funcionalidades após verificar novamente o seu email.',[m
[31m-        edit_username_help: 'Este nome só pode ser definido uma vez. Se você preencher agora, não poderá alterar posteriormente.',[m
[31m-        email: 'Email',[m
[31m-        email_help: 'Deseja utilizar este email para receber nossas atualizações? Se você escolher outro, nós enviaremos um email de verificação e você só poderá utilizar as principais funcionalidades após verificar o seu email.',[m
[31m-        email_sended: 'Email enviado com sucesso, aguarde o nosso contato',[m
[32m+[m[32m        confirm_your_password: 'Confirme sua senha',[m
[32m+[m[32m        email_sended: 'E-mail enviado com sucesso, aguarde o nosso contato',[m
         error_sending_email: 'Erro ao enviar o e-mail, por favor tente novamente mais tarde',[m
         female: 'Feminino',[m
         gender: 'Gênero',[m
[32m+[m[32m        let_us_see_if_we_know_your_email: 'Deixe-nos verificar se conhecemos o seu email',[m
         location: 'Localização',[m
         male: 'Masculino',[m
         message: 'Mensagem',[m
         name: 'Nome',[m
         now_you_are_connected_with: 'Agora você está conectado com o',[m
[31m-        optional: 'opcional',[m
[32m+[m[32m        ok_we_know_your_email: 'Certo {{ user }}, nós conhecemos o seu email. Por favor confirme com sua senha.',[m
[32m+[m[32m        password: 'Senha',[m
         picture: 'Foto',[m
[31m-        please_confirm_some_informations_about_your_account: 'Por favor confirme algumas informações sobre a sua conta',[m
[31m-        resend_verification_email: 'O email de verificação ainda não chegou? Envie novamente!',[m
[32m+[m[32m        register: 'Registrar',[m
         save: 'Salvar',[m
         save_changes: 'Salvar alterações',[m
         state: 'Estado',[m
[36m@@ -408,14 +401,12 @@[m [mangular[m
         use_facebook_picture: 'Usar a foto do Facebook',[m
         use_google_picture: 'Usar a foto do Google',[m
         use_twitter_picture: 'Usar a foto do Twitter',[m
[31m-        username: 'Nome de usuário',[m
[31m-        username_first_help: 'Os usuários poderão chegar até a página do seu perfil assim:',[m
[31m-        username_second_help: 'Este nome só pode ser definido uma vez. Se você preencher agora, não poderá alterar posteriormente. Caso contrário, basta acessar as configurações da sua conta.',[m
         wait_a_moment_you_will_be_redirected: 'Você será redirecionado para onde estava em 10 segundos',[m
[32m+[m[32m        we_dont_know_your_email: 'Nós não conhecemos o seu email, por favor continue com o seu cadastro.',[m
         welcome_to: 'Bem-vindo ao Cover Academy',[m
         what_is_your_name: 'Qual é o seu nome?',[m
         where_are_you: 'Onde você está?',[m
[31m-        write_something_about_you: 'Escreva algo sobre a você',[m
[32m+[m[32m        write_something_about_your_passion_for_music: 'Escreva algo sobre a sua paixão por música',[m
         you_are_connecting_with: 'Você está conectado com o'[m
       },[m
       menus: {[m
[36m@@ -461,8 +452,6 @@[m [mangular[m
           cover: 'Cover de {{ author }} da música "{{ music }}" de {{ artist }}',[m
           covers: 'Os melhores covers em um só lugar',[m
           covers_rank: 'Os {{ rankType }} covers da semana',[m
[31m-          error_404: 'Página não encontrada',[m
[31m-          error_500: 'Erro interno',[m
           guideline: 'Leia o nosso guia da competição e saiba como participar!',[m
           index: 'Entre na nossa competição de música agora!',[m
           join_contest: 'Participe agora da competição!',[m
[36m@@ -471,7 +460,6 @@[m [mangular[m
           music_genre_rank: 'Os {{ rankType }} covers {{ musicGenre }}',[m
           privacy_policy: 'Política de privacidade',[m
           search: 'Resultados da busca por "{{ searchQuery }}"',[m
[31m-          settings: 'Configurações',[m
           terms_of_use: 'Termos de uso'[m
         },[m
         description: {[m
[1mdiff --git a/public/app/services/services.js b/public/app/services/services.js[m
[1mindex b5a4ede..2f32e85 100644[m
[1m--- a/public/app/services/services.js[m
[1m+++ b/public/app/services/services.js[m
[36m@@ -71,7 +71,7 @@[m [mangular[m
     }, 8000);[m
   };[m
 }])[m
[31m-.service('authenticationService', ['$rootScope', '$modal', '$window', '$q', '$cookieStore', '$underscore', 'constants', 'authEvents', 'userService', function($rootScope, $modal, $window, $q, $cookieStore, $underscore, constants, authEvents, userService) {[m
[32m+[m[32m.service('authenticationService', ['$rootScope', '$state', '$modal', '$window', '$q', '$cookieStore', '$underscore', 'constants', 'authEvents', 'userService', function($rootScope, $state, $modal, $window, $q, $cookieStore, $underscore, constants, authEvents, userService) {[m
   var $ = this;[m
   var user = $cookieStore.get(constants.USER_COOKIE) || null;[m
   var changeUser = function(newUser) {[m
[36m@@ -96,24 +96,23 @@[m [mangular[m
 [m
   $.updateUser();[m
 [m
[31m-  var loginModalOptions = {[m
[32m+[m[32m   var modalOptions = {[m
[32m+[m[32m    backdrop: true,[m
     keyboard: true,[m
     templateUrl: '/app/partials/widgets/login-modal.html',[m
[31m-    controller: 'loginController'[m
[31m-  };[m
[31m-  var registerModalOptions = {[m
[31m-    keyboard: true,[m
[31m-    backdrop: false,[m
[31m-    size: 'lg',[m
[31m-    templateUrl: '/app/partials/widgets/register-modal.html',[m
[31m-    resolve: {[m
[31m-      temporaryUser: function(userService) {[m
[31m-        return userService.getTemporaryUser().then(function(response) {[m
[31m-          return response.data;[m
[32m+[m[32m    controller: function($scope, $modalInstance) {[m
[32m+[m[32m      $scope.modalScope = {};[m
[32m+[m[32m      $scope.modalScope.close = function(result) {[m
[32m+[m[32m        $modalInstance.dismiss('cancel');[m
[32m+[m[32m      };[m
[32m+[m[32m      $scope.modalScope.auth = function(provider) {[m
[32m+[m[32m        $.login(provider).then(function(user) {[m
[32m+[m[32m          $modalInstance.close($.isAuthenticated());[m
[32m+[m[32m        }).catch(function(err) {[m
[32m+[m[32m          $modalInstance.close($.isAuthenticated());[m
         });[m
[31m-      }[m
[31m-    },[m
[31m-    controller: 'registerController'[m
[32m+[m[32m      };[m
[32m+[m[32m    }[m
   };[m
   this.isAuthenticated = function() {[m
     return user ? true : false;[m
[36m@@ -127,54 +126,45 @@[m [mangular[m
     return !accessLevel || $underscore.contains(accessLevel.roles, userRole);[m
   };[m
   this.login = function(provider) {[m
[31m-    var deferred = $q.defer();[m
     if(provider) {[m
[32m+[m[32m      var deferred = $q.defer();[m
       var left = ($window.screen.width / 2) - (780 / 2);[m
       var top = ($window.screen.height / 2) - (410 / 2);[m
       var win = $window.open(userService.loginEndpoint(provider), 'SignIn', 'width=780,height=410,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0,left=' + left + ',top=' + top);[m
       win.focus();[m
       $window.authResult = function(result, message) {[m
[31m-        if(result === 'must-register') {[m
[31m-          win.close();[m
[31m-          $modal.open(registerModalOptions).result.then(function(registered) {[m
[31m-            if(registered === true) {[m
[31m-              $.updateUser().then(function(userUpdated) {[m
[31m-                deferred.resolve(userUpdated);[m
[31m-                $rootScope.$broadcast(authEvents.USER_REGISTERED);[m
[31m-              }).catch(function(err) {[m
[31m-                deferred.reject(err);[m
[31m-                $rootScope.$broadcast(authEvents.FAIL_REGISTERING_USER);[m
[31m-              });[m
[31m-            } else {[m
[31m-              deferred.reject();[m
[31m-              $rootScope.$broadcast(authEvents.FAIL_REGISTERING_USER);[m
[31m-            }[m
[32m+[m[32m        if(result === 'success') {[m
[32m+[m[32m          userService.getAuthenticatedUser().then(function(response) {[m
[32m+[m[32m            changeUser(response.data);[m
[32m+[m[32m            deferred.resolve(user);[m
[32m+[m[32m            $rootScope.$broadcast(authEvents.LOGIN_SUCCESS);[m
[32m+[m[32m          }).catch(function(err) {[m
[32m+[m[32m            deferred.reject(err);[m
[32m+[m[32m            $rootScope.$broadcast(authEvents.LOGIN_FAILED);[m
           });[m
[31m-        } else {[m
[31m-          if(result === 'success') {[m
[31m-            $.updateUser().then(function(userUpdated) {[m
[31m-              deferred.resolve(userUpdated);[m
[31m-              $rootScope.$broadcast(authEvents.LOGIN_SUCCESS);[m
[31m-            }).catch(function(err) {[m
[31m-              deferred.reject(err);[m
[31m-              $rootScope.$broadcast(authEvents.LOGIN_FAILED);[m
[31m-            });[m
[31m-          } else if(result === 'fail') {[m
[31m-            deferred.reject();[m
[31m-            $rootScope.$broadcast(authEvents.LOGIN_FAILED, message);[m
[31m-          }[m
[31m-          win.close();[m
[32m+[m[32m        } else if(result === 'must-register') {[m
[32m+[m[32m          deferred.resolve();[m
[32m+[m[32m          $rootScope.$broadcast(authEvents.MUST_REGISTER);[m
[32m+[m[32m        } else if(result === 'fail') {[m
[32m+[m[32m          deferred.reject();[m
[32m+[m[32m          $rootScope.$broadcast(authEvents.LOGIN_FAILED, message);[m
         }[m
[32m+[m[32m        win.close();[m
       }[m
       return deferred.promise;[m
     } else {[m
[31m-      $modal.open(loginModalOptions).result.then(function(authenticated) {[m
[31m-        if(authenticated === true) {[m
[31m-          deferred.resolve(user);[m
[31m-        } else {[m
[31m-          deferred.reject();[m
[31m-        }[m
[31m-      });[m
[32m+[m[32m      var deferred = $q.defer();[m
[32m+[m[32m      if(!$.isAuthenticated()) {[m
[32m+[m[32m        $modal.open(modalOptions).result.then(function(authenticated) {[m
[32m+[m[32m          if(authenticated === true) {[m
[32m+[m[32m            deferred.resolve(true);[m
[32m+[m[32m          } else {[m
[32m+[m[32m            deferred.reject(false);[m
[32m+[m[32m          }[m
[32m+[m[32m        });[m
[32m+[m[32m      } else {[m
[32m+[m[32m        deferred.resolve(true);[m
[32m+[m[32m      }[m
       return deferred.promise;[m
     }[m
   };[m
[36m@@ -229,9 +219,8 @@[m [mangular[m
     'contest.join.userAlreadyInContest': 'errors.join_contest_user_already_in_contest',[m
     'contest.join.videoDateIsNotValid': 'errors.join_contest_video_date_is_not_valid',[m
     'contest.join.videoNotOwnedByUser': 'errors.join_contest_video_not_owned_by_user',[m
[31m-    'user.edit.invalidUsername': 'errors.user_edit_invalid_username',[m
[31m-    'user.verification.emailAlreadyVerified': 'errors.user_verification_email_already_verified',[m
[31m-    'user.verification.errorSendingVerificationEmail': 'errors.user_verification_error_sending_verification_email',[m
[32m+[m[32m    'user.auth.accountNotFound': 'errors.user_auth_account_not_found',[m
[32m+[m[32m    'user.auth.passwordWithFewerCharacters': 'errors.user_auth_password_with_fewer_characteres',[m
     'youtube.videoURLNotValid': 'errors.youtube_video_url_not_valid',[m
     'internalError': 'errors.unexpected_error',[m
     'unexpectedError': 'errors.unexpected_error',[m
[36m@@ -290,12 +279,6 @@[m [mangular[m
   this.getAuthenticatedUser = function() {[m
     return $http.get('/api/user/authenticated');[m
   };[m
[31m-  this.getTemporaryUser = function() {[m
[31m-    return $http.get('/api/user/temporary');[m
[31m-  };[m
[31m-  this.verificationEmail = function(user) {[m
[31m-    return $http.post('/api/user/verification', {user: user.id});[m
[31m-  };[m
   this.sendEmail = function(name, email, subject, message) {[m
     return $http.post('/api/user/email', {name: name, email: email, subject: subject, message: message});[m
   };[m
[36m@@ -305,8 +288,8 @@[m [mangular[m
   this.update = function(user) {[m
     return $http.put('/api/user', {user: user});[m
   };[m
[31m-  this.connect = function(networkType, networkAccount) {[m
[31m-    return $http.post('/api/user/connect', {network_type: networkType, network_account: networkAccount});[m
[32m+[m[32m  this.connect = function(email, password, user, networkType, networkAccount) {[m
[32m+[m[32m    return $http.post('/api/user/connect', {email: email, password: password, user: user.id, network_type: networkType, network_account: networkAccount});[m
   };[m
   this.get = function(id) {[m
     return $http.get('/api/user', {params: {id: id}});[m
[36m@@ -314,26 +297,15 @@[m [mangular[m
   this.getByEmail = function(email) {[m
     return $http.get('/api/user', {params: {email: email}});[m
   };[m
[31m-  this.getProfilePictureType = function(user) {[m
[31m-    var connection = null;[m
[31m-    if(user.profile_picture === 'facebook') {[m
[31m-      connection = {type: 'facebook', account: user.facebook_account};[m
[31m-    } else if(user.profile_picture === 'twitter') {[m
[31m-      connection = {type: 'twitter', account: user.twitter_account};[m
[31m-    } else if(user.profile_picture === 'google') {[m
[31m-      connection = {type: 'google', account: user.google_account};[m
[31m-    }[m
[31m-    return connection;[m
[31m-  };[m
   this.getProfilePicture = function(user, network) {[m
     var url = defaultProfilePicture;[m
[31m-    var picture = networkPictures[network ? network : user.profile_picture];[m
[32m+[m[32m    var picture = networkPictures[network ? network : user.primary_network];[m
     if(picture) {[m
       url = picture.get(user);[m
     }[m
     return url;[m
   };[m
[31m-  this.hasProfilePicture = function(user, network) {[m
[32m+[m[32m  this.hasNetworkConnection = function(user, network) {[m
     var hasConnection = false;[m
     if(network === 'facebook') {[m
       hasConnection = Boolean(user.facebook_account);[m
[36m@@ -344,8 +316,19 @@[m [mangular[m
     }[m
     return hasConnection;[m
   };[m
[31m-  this.isProfilePicture = function(user, network) {[m
[31m-    var connection = $.getProfilePictureType(user);[m
[32m+[m[32m  this.getPrimaryNetworkConnection = function(user) {[m
[32m+[m[32m    var connection = null;[m
[32m+[m[32m    if(user.primary_network === 'facebook') {[m
[32m+[m[32m      connection = {type: 'facebook', account: user.facebook_account};[m
[32m+[m[32m    } else if(user.primary_network === 'twitter') {[m
[32m+[m[32m      connection = {type: 'twitter', account: user.twitter_account};[m
[32m+[m[32m    } else if(user.primary_network === 'google') {[m
[32m+[m[32m      connection = {type: 'google', account: user.google_account};[m
[32m+[m[32m    }[m
[32m+[m[32m    return connection;[m
[32m+[m[32m  };[m
[32m+[m[32m  this.isPrimaryNetworkConnection = function(user, network) {[m
[32m+[m[32m    var connection = $.getPrimaryNetworkConnection(user);[m
     return connection.type === network;[m
   };[m
 }])[m
[36m@@ -403,11 +386,8 @@[m [mangular[m
   this.userView = function(id) {[m
     return $http.get('/view/user/' + id);[m
   };[m
[31m-  this.userIdView = function(id) {[m
[31m-    return $http.get('/view/user', {params: {id: id}});[m
[31m-  };[m
[31m-  this.verifyView = function(token) {[m
[31m-    return $http.get('/view/verify', {params: {token: token}});[m
[32m+[m[32m  this.registerView = function() {[m
[32m+[m[32m    return $http.get('/view/register');[m
   };[m
   this.settingsView = function() {[m
     return $http.get('/view/settings');[m
[36m@@ -473,8 +453,8 @@[m [mangular[m
   this.getAuditionVideoInfos = function(url) {[m
     return $http.get('/api/contest/audition/videoInfos', {params: {url: url}});[m
   };[m
[31m-  this.joinContest = function(audition) {[m
[31m-    return $http.post('/api/contest/join', {audition: audition});[m
[32m+[m[32m  this.submitAudition = function(audition, contest) {[m
[32m+[m[32m    return $http.post('/api/contest/audition/submit', {audition: audition, contest: contest.id});[m
   };[m
   this.isContestant = function(contest) {[m
     return $http.get('/api/contest/isContestant', {params: {contest_id: contest.id}});[m
[1mdiff --git a/public/css/index.css b/public/css/index.css[m
[1mindex 7b5815e..f0c0858 100644[m
[1m--- a/public/css/index.css[m
[1m+++ b/public/css/index.css[m
[36m@@ -139,8 +139,8 @@[m [mp, li {[m
   background-repeat: no-repeat;[m
   background-position: center center;[m
   text-decoration: none;[m
[31m-  height: 140px;[m
[31m-  width: 140px;[m
[32m+[m[32m  height: 160px;[m
[32m+[m[32m  width: 160px;[m
   position: relative;[m
   margin-right: 20px;[m
 }[m
[36m@@ -217,10 +217,6 @@[m [ma:hover {[m
   padding-top: 10px;[m
 }[m
 [m
[31m-.padding-left {[m
[31m-  padding-left: 10px;[m
[31m-}[m
[31m-[m
 .nopadding {[m
   padding: 0px;[m
 }[m
[36m@@ -359,10 +355,6 @@[m [ma:hover {[m
   font-size: 16px;[m
 }[m
 [m
[31m-#register-form .alert {[m
[31m-  margin-bottom: 0px;[m
[31m-}[m
[31m-[m
 .fade-in.ng-enter {[m
   -webkit-animation: fadeIn 1s;[m
   -moz-animation: fadeIn 1s;[m
[1mdiff --git a/public/img/contests/2.jpg b/public/img/contests/2.jpg[m
[1mdeleted file mode 100644[m
[1mindex 208808c..0000000[m
Binary files a/public/img/contests/2.jpg and /dev/null differ
[1mdiff --git a/readme.txt b/readme.txt[m
[1mindex d105d66..a34d402 100644[m
[1m--- a/readme.txt[m
[1m+++ b/readme.txt[m
[36m@@ -1,33 +1,15 @@[m
[31m-- Configure database[m
[31m-    $ vim /etc/mysql/my.cnf[m
[31m-      > Change from key_buffer property to key_buffer_size[m
[31m-      > Change from myisam-recover to myisam-recover-options[m
[31m-      > Set UTF-8 and the new timestamp behavior adding these properties after [mysqld] section:[m
[31m-        > explicit_defaults_for_timestamp = 1[m
[31m-        > collation_server                = utf8_unicode_ci[m
[31m-        > character_set_server            = utf8[m
[31m-        > skip-character-set-client-handshake[m
[31m-[m
 - Set up database[m
     $ cd cover-academy[m
     $ mysql -u <user> -p[m
       > create database cover_academy character set utf8 collate utf8_general_ci;[m
       > exit[m
[31m-    $ mysql -u <user> -p cover_academy < resources/schema.sql[m
[31m-    $ mysql -u <user> -p cover_academy < resources/data.sql[m
[31m-[m
[31m-- Install and set up Redis[m
[31m-      $ wget http://download.redis.io/releases/redis-2.8.17.tar.gz[m
[31m-      $ tar -xvf installers/redis-2.8.17.tar.gz[m
[31m-      $ cd redis-2.8.17[m
[31m-      $ make; make test; sudo make install;[m
[31m-      $ sudo utils/install_server.sh[m
[31m-      $ sudo service redis_6379 start[m
[32m+[m[32m    $ mysql -u <user -p cover_academy < resources/schema.sql[m
[32m+[m[32m    $ mysql -u <user -p cover_academy < resources/data.sql[m
 [m
 - Install Nginx[m
     $ sudo apt-get install nginx[m
 [m
[31m-- Configure Nginx sites availables[m
[32m+[m[32m- Configure Nginx sites availables[m[41m [m
 [m
     server {[m
       listen       80;[m
[1mdiff --git a/resources/schema.sql b/resources/schema.sql[m
[1mindex a0b8cc6..436badd 100644[m
[1m--- a/resources/schema.sql[m
[1m+++ b/resources/schema.sql[m
[36m@@ -2,10 +2,12 @@[m [mcreate table user ([m
   id                int(11) not null auto_increment,[m
   name              varchar(100) not null,[m
   email             varchar(255) not null,[m
[32m+[m[32m  password          varchar(255) not null,[m
   permission        enum('user', 'admin') default 'user',[m
   gender            enum('male', 'female') default 'male',[m
   biography         varchar(255) default null,[m
   username          varchar(255) default null,[m
[32m+[m[32m  image             varchar(255) default null,[m
   city              varchar(255) default null,[m
   state             varchar(255) default null,[m
   facebook_account  varchar(255) default null,[m
[36m@@ -15,9 +17,8 @@[m [mcreate table user ([m
   google_account    varchar(255) default null,[m
   google_picture    varchar(255) default null,[m
   youtube_account   varchar(255) default null,[m
[31m-  profile_picture   varchar(20) default null,[m
[32m+[m[32m  primary_network   varchar(20) default null,[m
   voting_power      decimal(6, 3) default 1.000,[m
[31m-  verified          tinyint(1) default 0,[m
   registration_date timestamp not null default current_timestamp,[m
   primary key (id),[m
   unique key `uq_user_username` (`username`),[m
[36m@@ -121,10 +122,10 @@[m [mcreate table contest ([m
   description         text not null,[m
   image               varchar(255) not null,[m
   minimum_contestants int(4) not null,[m
[31m-  acceptance_date     date not null,[m
   start_date          timestamp null default null,[m
   end_date            timestamp null default null,[m
   registration_date   timestamp not null default current_timestamp,[m
[32m+[m[32m  acceptance_date     date not null,[m
   duration            int(2) not null,[m
   finished            tinyint(1) default 0,[m
   primary key (id),[m
[36m@@ -145,6 +146,7 @@[m [mcreate table audition ([m
   medium_thumbnail  varchar(255) default null,[m
   large_thumbnail   varchar(255) default null,[m
   place             int(1) default null,[m
[32m+[m[32m  approved          tinyint(1) default 0,[m
   registration_date timestamp not null default current_timestamp,[m
   primary key (id),[m
   unique key `uq_audition_url` (`url`),[m
[36m@@ -165,13 +167,4 @@[m [mcreate table user_vote ([m
   unique key `uq_user_vote_user_id_audition_id` (`user_id`, `audition_id`),[m
   constraint `fk_user_vote_user_id` foreign key (`user_id`) references `user` (`id`),[m
   constraint `fk_user_vote_audition_id` foreign key (`audition_id`) references `audition` (`id`)[m
[31m-) engine = innodb default charset = utf8;[m
[31m-[m
[31m-create table verification_token ([m
[31m-  token             varchar(255) not null,[m
[31m-  user_id           int(11) not null,[m
[31m-  expiration_date   timestamp not null,[m
[31m-  registration_date timestamp not null default current_timestamp,[m
[31m-  primary key (token),[m
[31m-  constraint `fk_verification_token_user_id` foreign key (`user_id`) references `user` (`id`)[m
 ) engine = innodb default charset = utf8;[m
\ No newline at end of file[m
[1mdiff --git a/routes/contest.js b/routes/contest.js[m
[1mindex 91d55d9..9f5fa42 100644[m
[1m--- a/routes/contest.js[m
[1m+++ b/routes/contest.js[m
[36m@@ -18,11 +18,12 @@[m [mmodule.exports = function(router, app) {[m
     });[m
   });[m
 [m
[31m-  router.post('/join', isAuthenticated, function(req, res, next) {[m
[32m+[m[32m  router.post('/audition/submit', isAuthenticated, function(req, res, next) {[m
     var auditionData = req.param('audition');[m
[32m+[m[32m    var contest = Contest.forge({id: req.param('contest')});[m
     var user = req.user;[m
[31m-    contestService.joinContest(user, auditionData).then(function(joined) {[m
[31m-      res.json(joined.audition);[m
[32m+[m[32m    contestService.submitAudition(user, contest, auditionData).then(function(audition) {[m
[32m+[m[32m      res.json(audition);[m
     }).catch(function(err) {[m
       console.log(err);[m
       messages.respondWithError(err, res);[m
[1mdiff --git a/routes/upload.js b/routes/upload.js[m
[1mindex 802fa0f..a6824c3 100644[m
[1m--- a/routes/upload.js[m
[1m+++ b/routes/upload.js[m
[36m@@ -1,5 +1,6 @@[m
 var userService = require('../apis/userService'),[m
     settings    = require('../configs/settings'),[m
[32m+[m[32m    User        = require('../models/models').User,[m
     flow        = require('../utils/flow-node.js')(settings.tmpUploadPath),[m
     fileUtils   = require('../utils/fileUtils'),[m
     path        = require('path'),[m
[36m@@ -12,7 +13,7 @@[m [mmodule.exports = function(router, app) {[m
   router.post('/user', multipart(), function(req, res) {[m
     flow.post(req, function(status, filename, originalFilename, identifier) {[m
       if(status === 'done') {[m
[31m-        var user = userService.forge({id: parseInt(req.body.user)});[m
[32m+[m[32m        var user = User.forge({id: parseInt(req.body.user)});[m
         var userPhoto = fileUtils.userPhotoFilename(user, path.extname(filename));[m
         var userPhotoPath = fileUtils.userPhotoFilePath(userPhoto);[m
         user.set('image', userPhoto);[m
[1mdiff --git a/routes/user.js b/routes/user.js[m
[1mindex a6a7add..8f96688 100644[m
[1m--- a/routes/user.js[m
[1m+++ b/routes/user.js[m
[36m@@ -1,6 +1,7 @@[m
 var userService     = require('../apis/userService'),[m
     mailService     = require('../apis/mailService'),[m
     messages        = require('../apis/messages'),[m
[32m+[m[32m    User            = require('../models/models').User,[m
     authorization   = require('../utils/authorization'),[m
     isAuthenticated = authorization.isAuthenticated,[m
     isTemporaryUser = authorization.isTemporaryUser;[m
[36m@@ -28,10 +29,14 @@[m [mmodule.exports = function(router, app) {[m
     });[m
   });[m
 [m
[31m-  router.post('/connect', isAuthenticated, function(req, res, next) {[m
[32m+[m[32m  router.post('/connect', isTemporaryUser, function(req, res, next) {[m
[32m+[m[32m    var email = req.param('email');[m
[32m+[m[32m    var password = req.param('password');[m
[32m+[m[32m    var user = User.forge({id: req.param('user')});[m
     var networkType = req.param('network_type');[m
     var networkAccount = req.param('network_account');[m
[31m-    userService.connectNetwork(req.user, networkType, networkAccount).then(function(userAssociated) {[m
[32m+[m
[32m+[m[32m    userService.connectNetwork(email, password, user, networkType, networkAccount).then(function(userAssociated) {[m
       return authorization.refreshUser(req, userAssociated);[m
     }).then(function(refreshedUser) {[m
       res.json(refreshedUser);[m
[36m@@ -55,7 +60,7 @@[m [mmodule.exports = function(router, app) {[m
 [m
   router.put('/', isAuthenticated, function(req, res, next) {[m
     var user = req.param('user');[m
[31m-    userService.update(req.user, userService.forge(user)).then(function(userSaved) {[m
[32m+[m[32m    userService.update(req.user, User.forge(user)).then(function(userSaved) {[m
       res.json(userSaved);[m
     }).catch(function(err) {[m
       console.log(err);[m
[36m@@ -78,16 +83,6 @@[m [mmodule.exports = function(router, app) {[m
     });[m
   });[m
 [m
[31m-  router.post('/verification', isAuthenticated, function(req, res, next) {[m
[31m-    var user = userService.forge({id: req.param('user')});[m
[31m-    userService.resendVerificationEmail(user).then(function() {[m
[31m-      res.json({});[m
[31m-    }).catch(function(err) {[m
[31m-      console.log(err);[m
[31m-      messages.respondWithError(err, res);[m
[31m-    });[m
[31m-  });[m
[31m-[m
   app.use('/api/user', router);[m
 [m
 }[m
\ No newline at end of file[m
[1mdiff --git a/routes/view.js b/routes/view.js[m
[1mindex efb9a5b..25b2323 100644[m
[1m--- a/routes/view.js[m
[1m+++ b/routes/view.js[m
[36m@@ -37,26 +37,33 @@[m [mmodule.exports = function(router, app) {[m
     }).catch(function(err) {[m
       console.log(err);[m
       messages.respondWithError(err, res);[m
[31m-    });[m
[32m+[m[32m    })[m
   });[m
 [m
   // AUTHENTICATED ROUTES[m
[32m+[m
[32m+[m[32m  router.get('/register', isTemporaryUser, function(req, res, next) {[m
[32m+[m[32m    res.json({[m
[32m+[m[32m      temporaryUser: authorization.getTemporaryUser(req)[m
[32m+[m[32m    });[m
[32m+[m[32m  });[m
[32m+[m
   router.get('/settings', isAuthenticated, function(req, res, next) {[m
     res.json({});[m
   });[m
 [m
   // PUBLIC ROUTES[m
   router.get('/index', function(req, res, next) {[m
[31m-    contestService.listContests().then(function(contests) {[m
[32m+[m[32m    contestService.listUnfinishedContests().then(function(contests) {[m
       if(contests.length > 0) {[m
[31m-        messages.respondWithRedirection('contest', {id: contests.at(contests.length - 1).id, slug: contests.at(contests.length - 1).get('slug')}, res);[m
[32m+[m[32m        messages.respondWithRedirection('contest', {id: contests.at(0).id, slug: contests.at(0).get('slug')}, res);[m
       } else {[m
         messages.respondWithRedirection('covers', {}, res);[m
       }[m
     }).catch(function(err) {[m
       console.log(err);[m
       messages.respondWithError(err, res);[m
[31m-    });[m
[32m+[m[32m    })[m
   });[m
 [m
   router.get('/cover/:id/:slug', function(req, res, next) {[m
[36m@@ -68,8 +75,7 @@[m [mmodule.exports = function(router, app) {[m
       } else if(slug !== cover.get('slug')) {[m
         messages.respondWithMovedPermanently('cover', {id: cover.id, slug: cover.get('slug')}, res);[m
       } else {[m
[31m-        Promise.all([coverService.bestCoversOfMusic(cover.related('music'), constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST), coverService.bestCoversByArtist(cover.related('artist'), constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST)])[m
[31m-        .spread(function(bestCoversOfMusic, bestCoversByArtist) {[m
[32m+[m[32m        return Promise.all([coverService.bestCoversOfMusic(cover.related('music'), constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST), coverService.bestCoversByArtist(cover.related('artist'), constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST)]).spread(function(bestCoversOfMusic, bestCoversByArtist) {[m
           res.json({[m
             cover: cover,[m
             bestCoversOfMusic: bestCoversOfMusic,[m
[36m@@ -84,14 +90,11 @@[m [mmodule.exports = function(router, app) {[m
   });[m
 [m
   router.get('/covers', function(req, res, next) {[m
[31m-    Promise[m
[31m-    .all([coverService.topCover(), coverService.bestCovers(constants.WEEK_PERIOD, constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST), coverService.latestCovers(constants.WEEK_PERIOD, constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST), coverService.musicGenres()])[m
[31m-    .spread(function(topCover, bestCovers, latestCovers, musicGenres) {[m
[32m+[m[32m    Promise.all([coverService.topCover(), coverService.bestCovers(constants.WEEK_PERIOD, constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST), coverService.latestCovers(constants.WEEK_PERIOD, constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST), coverService.musicGenres()]).spread(function(topCover, bestCovers, latestCovers, musicGenres) {[m
       this.topCover = topCover;[m
       this.bestCovers = bestCovers;[m
       this.latestCovers = latestCovers;[m
       this.musicGenres = musicGenres;[m
[31m-[m
       var musicGenre = musicGenres.at(math.getRandomInt(0, musicGenres.size() - 1));[m
       return coverService.bestArtistsOfMusicGenre(musicGenre, constants.FIRST_PAGE, constants.NUMBER_OF_ARTISTS_IN_INDEX_VIEW);[m
     }).then(function(bestArtistsOfMusicGenre) {[m
[36m@@ -140,8 +143,7 @@[m [mmodule.exports = function(router, app) {[m
       if(!artist) {[m
         messages.respondWithNotFound(res);[m
       } else {[m
[31m-        Promise.all([coverService.totalMusicsByArtist(artist), coverService.lastMusicsByArtist(artist, constants.FIRST_PAGE, constants.NUMBER_OF_MUSICS_BY_ARTIST)])[m
[31m-        .spread(function(totalMusicsByArtist, musicsByArtist) {[m
[32m+[m[32m        return Promise.all([coverService.totalMusicsByArtist(artist), coverService.lastMusicsByArtist(artist, constants.FIRST_PAGE, constants.NUMBER_OF_MUSICS_BY_ARTIST)]).spread(function(totalMusicsByArtist, musicsByArtist) {[m
           this.totalMusicsByArtist = totalMusicsByArtist;[m
           this.musicsByArtist = musicsByArtist;[m
           var coversOfMusics;[m
[36m@@ -191,8 +193,7 @@[m [mmodule.exports = function(router, app) {[m
         messages.respondWithNotFound(res);[m
       } else {[m
         var coversOfMusicPromise = rank === 'best' ? coverService.bestCoversOfMusic : coverService.latestCoversOfMusic;[m
[31m-        Promise.all([coverService.totalCoversOfMusic(music), coversOfMusicPromise(music, constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_LIST)])[m
[31m-        .spread(function(totalCoversOfMusic, coversOfMusic) {[m
[32m+[m[32m        return Promise.all([coverService.totalCoversOfMusic(music), coversOfMusicPromise(music, constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_LIST)]).spread(function(totalCoversOfMusic, coversOfMusic) {[m
           res.json({[m
             music: music,[m
             totalCoversOfMusic: totalCoversOfMusic,[m
[36m@@ -212,8 +213,7 @@[m [mmodule.exports = function(router, app) {[m
       if(!musicGenre) {[m
         messages.respondWithNotFound(res);[m
       } else {[m
[31m-        Promise.all([coverService.bestArtistsOfMusicGenre(musicGenre, constants.FIRST_PAGE, constants.NUMBER_OF_ARTISTS_IN_SUMMARIZED_LIST), coverService.bestCoversOfMusicGenre(musicGenre, constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST), coverService.latestCoversOfMusicGenre(musicGenre, constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST)]).bind({})[m
[31m-        .spread(function(bestArtistsOfMusicGenre, bestCoversOfMusicGenre, latestCoversOfMusicGenre) {[m
[32m+[m[32m        return Promise.all([coverService.bestArtistsOfMusicGenre(musicGenre, constants.FIRST_PAGE, constants.NUMBER_OF_ARTISTS_IN_SUMMARIZED_LIST), coverService.bestCoversOfMusicGenre(musicGenre, constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST), coverService.latestCoversOfMusicGenre(musicGenre, constants.FIRST_PAGE, constants.NUMBER_OF_COVERS_IN_SUMMARIZED_LIST)]).bind({}).spread(function(bestArtistsOfMusicGenre, bestCoversOfMusicGenre, latestCoversOfMusicGenre) {[m
           res.json({[m
             musicGenre: musicGenre,[m
             bestArtistsOfMusicGenre: bestArtistsOfMusicGenre,[m
[36m@@ -240,8 +240,7 @@[m [mmodule.exports = function(router, app) {[m
           messages.respondWithNotFound(res);[m
         } else {[m
           var coversOfMusicGenrePromise = rank === 'best' ? coverService.bestCoversOfMusicGenre : coverService.latestCoversOfMusicGenre;[m
[31m-          Promise.all([coversOfMusicGenrePromise(musicGenre, page, constants.NUMBER_OF_COVERS_IN_LIST), coverService.totalCoversOfMusicGenre(musicGenre)]).bind({})[m
[31m-          .spread(function(coversOfMusicGenre, totalCoversOfMusicGenre) {[m
[32m+[m[32m          return Promise.all([coversOfMusicGenrePromise(musicGenre, page, constants.NUMBER_OF_COVERS_IN_LIST), coverService.totalCoversOfMusicGenre(musicGenre)]).bind({}).spread(function(coversOfMusicGenre, totalCoversOfMusicGenre) {[m
             res.json({[m
               musicGenre: musicGenre,[m
               coversOfMusicGenre: coversOfMusicGenre,[m
[36m@@ -258,8 +257,7 @@[m [mmodule.exports = function(router, app) {[m
 [m
   router.get('/search', function(req, res, next) {[m
     var query = req.param('query');[m
[31m-    Promise.all([coverService.searchArtists(query), coverService.searchMusics(query)])[m
[31m-    .spread(function(artists, musics) {[m
[32m+[m[32m    Promise.all([coverService.searchArtists(query), coverService.searchMusics(query)]).spread(function(artists, musics) {[m
       this.artists = artists;[m
       this.musics = musics;[m
       return Promise.all([coverService.bestCoversByArtists(artists, 6), coverService.bestCoversOfMusics(musics, 6)]);[m
[36m@@ -289,8 +287,7 @@[m [mmodule.exports = function(router, app) {[m
         contest.set('progress', contest.getProgress());[m
         var auditionsPromise = rankType === 'best' && contest.get('progress') !== 'waiting' ? contestService.bestAuditions : contestService.latestAuditions;[m
         var winnersPromise = contest.get('progress') === 'finished' ? contestService.getWinnerAuditions(contest) : null;[m
[31m-        Promise.all([auditionsPromise(contest, constants.FIRST_PAGE, constants.NUMBER_OF_AUDITIONS_IN_LIST), contestService.totalAuditions(contest), contestService.getUserAudition(req.user, contest), winnersPromise, contestService.getUserVotes(req.user, contest)])[m
[31m-        .spread(function(auditions, totalAuditions, audition, winnerAuditions, userVotes) {[m
[32m+[m[32m        return Promise.all([auditionsPromise(contest, constants.FIRST_PAGE, constants.NUMBER_OF_AUDITIONS_IN_LIST), contestService.totalAuditions(contest), contestService.getUserAudition(req.user, contest), winnersPromise, contestService.getUserVotes(req.user, contest)]).spread(function(auditions, totalAuditions, audition, winnerAuditions, userVotes) {[m
           this.auditions = auditions;[m
           this.userVotes = userVotes;[m
           this.totalAuditions = totalAuditions;[m
[36m@@ -314,7 +311,7 @@[m [mmodule.exports = function(router, app) {[m
     }).catch(function(err) {[m
       console.log(err);[m
       messages.respondWithError(err, res);[m
[31m-    });[m
[32m+[m[32m    })[m
   });[m
 [m
   router.get('/contest/:id/:slug/join', function(req, res, next) {[m
[36m@@ -327,14 +324,17 @@[m [mmodule.exports = function(router, app) {[m
         messages.respondWithMovedPermanently('joinContest', {id: contest.id, slug: contest.get('slug')}, res);[m
       } else {[m
         contest.set('progress', contest.getProgress());[m
[31m-        res.json({[m
[31m-          contest: contest[m
[32m+[m[32m        return contestService.getUserAudition(req.user, contest).then(function(audition) {[m
[32m+[m[32m          res.json({[m
[32m+[m[32m            contest: contest,[m
[32m+[m[32m            audition: audition[m
[32m+[m[32m          });[m
         });[m
       }[m
     }).catch(function(err) {[m
       console.log(err);[m
       messages.respondWithError(err, res);[m
[31m-    });[m
[32m+[m[32m    })[m
   });[m
 [m
   router.get('/audition/:id/:slug', function(req, res, next) {[m
[36m@@ -348,8 +348,7 @@[m [mmodule.exports = function(router, app) {[m
       } else {[m
         var contest = audition.related('contest');[m
         contest.set('progress', contest.getProgress());[m
[31m-        Promise.all([contestService.countUserVotes(req.user, contest), contestService.getUserVote(req.user, audition), contestService.getAuditionVotes(audition), contestService.getAuditionScore(audition), contestService.bestAuditions(contest, 1, 8), contestService.latestAuditions(contest, 1, 8), contestService.totalAuditions(contest)])[m
[31m-        .spread(function(totalUserVotes, userVote, votes, score, bestAuditions, latestAuditions, totalAuditions) {[m
[32m+[m[32m        return Promise.all([contestService.countUserVotes(req.user, contest), contestService.getUserVote(req.user, audition), contestService.getAuditionVotes(audition), contestService.getAuditionScore(audition), contestService.bestAuditions(contest, 1, 8), contestService.latestAuditions(contest, 1, 8), contestService.totalAuditions(contest)]).spread(function(totalUserVotes, userVote, votes, score, bestAuditions, latestAuditions, totalAuditions) {[m
           res.json({[m
             contest: contest,[m
             audition: audition,[m
[36m@@ -367,37 +366,16 @@[m [mmodule.exports = function(router, app) {[m
     }).catch(function(err) {[m
       console.log(err);[m
       messages.respondWithError(err, res);[m
[31m-    });[m
[32m+[m[32m    })[m
   });[m
 [m
[31m-  router.get('/user/:username', function(req, res, next) {[m
[31m-    var username = req.param('username');[m
[31m-    userService.findByUsername(username).then(function(user) {[m
[31m-      if(!user) {[m
[31m-        messages.respondWithNotFound(res);[m
[31m-      } else {[m
[31m-        contestService.getUserAuditions(user).then(function(auditions) {[m
[31m-          res.json({[m
[31m-            user: user,[m
[31m-            auditions: auditions[m
[31m-          });[m
[31m-        });[m
[31m-      }[m
[31m-    }).catch(function(err) {[m
[31m-      console.log(err);[m
[31m-      messages.respondWithError(err, res);[m
[31m-    });[m
[31m-  });[m
[31m-[m
[31m-  router.get('/user', function(req, res, next) {[m
[32m+[m[32m  router.get('/user/:id', function(req, res, next) {[m
     var id = req.param('id');[m
[31m-    userService.findById(id).then(function(user) {[m
[32m+[m[32m    userService.getUser(id).then(function(user) {[m
       if(!user) {[m
         messages.respondWithNotFound(res);[m
[31m-      } else if(user.get('username')) {[m
[31m-        messages.respondWithMovedPermanently('user', {username: user.get('username')}, res);[m
       } else {[m
[31m-        contestService.getUserAuditions(user).then(function(auditions) {[m
[32m+[m[32m        return contestService.getUserAuditions(user).then(function(auditions) {[m
           res.json({[m
             user: user,[m
             auditions: auditions[m
[36m@@ -407,27 +385,7 @@[m [mmodule.exports = function(router, app) {[m
     }).catch(function(err) {[m
       console.log(err);[m
       messages.respondWithError(err, res);[m
[31m-    });[m
[31m-  });[m
[31m-[m
[31m-  router.get('/verify', function(req, res, next) {[m
[31m-    var token = req.param('token');[m
[31m-    if(!token) {[m
[31m-      messages.respondWithMovedPermanently('index', {}, res);[m
[31m-    } else {[m
[31m-      userService.verifyEmail(token).then(function(user) {[m
[31m-        if(!user) {[m
[31m-          messages.respondWithMovedPermanently('index', {}, res);[m
[31m-        } else {[m
[31m-          res.json({[m
[31m-            user: user[m
[31m-          });[m
[31m-        }[m
[31m-      }).catch(function(err) {[m
[31m-        console.log(err);[m
[31m-        messages.respondWithMovedPermanently('index', {}, res);[m
[31m-      });[m
[31m-    }[m
[32m+[m[32m    })[m
   });[m
 [m
   app.use('/view', router);[m
[1mdiff --git a/utils/modelUtils.js b/utils/modelUtils.js[m
[1mindex 08c10c3..c71d714 100644[m
[1m--- a/utils/modelUtils.js[m
[1m+++ b/utils/modelUtils.js[m
[36m@@ -12,8 +12,8 @@[m [mfunction filter(data, attributes) {[m
 [m
 exports.modelsAttributes = {[m
   MusicEditableAttributes: ['title', 'artist_id', 'small_thumbnail', 'medium_thumbnail', 'large_thumbnail'],[m
[31m-  UserEditableAttributes: ['name', 'email', 'username', 'gender', 'biography', 'city', 'state', 'profile_picture', 'verified'],[m
[31m-  UserCreationAttributes: ['name', 'email', 'username', 'gender', 'facebook_account', 'facebook_picture', 'profile_picture', 'verified', 'permission'][m
[32m+[m[32m  UserEditableAttributes: ['name', 'gender', 'biography', 'city', 'state', 'primary_network'],[m
[32m+[m[32m  UserCreationAttributes: ['email', 'password', 'name', 'gender', 'facebook_account', 'facebook_picture', 'twitter_account', 'twitter_picture', 'google_account', 'google_picture', 'primary_network'][m
 }[m
 [m
 exports.filterAttributes = function(data, attributesName) {[m
[1mdiff --git a/utils/slug.js b/utils/slug.js[m
[1mindex 4e4f181..5c14d2f 100644[m
[1m--- a/utils/slug.js[m
[1m+++ b/utils/slug.js[m
[36m@@ -16,17 +16,10 @@[m [mslug.charmap['@'] = ' ';[m
 slug.charmap['&'] = 'and';[m
 slug.charmap['\''] = ' ';[m
 [m
[31m-var usernameRegexp = new RegExp('^[a-z0-9.]{5,20}$');[m
[31m-[m
 exports.slugify = function(str) {[m
   var slugified = '';[m
   if(str) {[m
     slugified = slug(str).toLowerCase();[m
   }[m
   return slugified;[m
[31m-}[m
[31m-[m
[31m-exports.isValidUsername = function(username) {[m
[31m-  return username && usernameRegexp.test(username);[m
[31m-}[m
[31m-[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/views/index.html b/views/index.html[m
[1mindex 287097e..bffde76 100644[m
[1m--- a/views/index.html[m
[1m+++ b/views/index.html[m
[36m@@ -83,7 +83,7 @@[m
               </a>[m
               <ul class="dropdown-menu">[m
                 <li ng-if="user()">[m
[31m-                  <a ui-sref="{{ userState(user()) }}">[m
[32m+[m[32m                  <a ui-sref="app.user({locale: locale(), id: user().id})">[m
                     <i class="glyphicon glyphicon-user"></i> {{ 'menus.profile' | translate }}[m
                   </a>[m
                 </li>[m
[36m@@ -210,6 +210,7 @@[m
 [m
     <script src="/lib/ng-flow/dist/ng-flow-standalone.min.js"></script>[m
     <script src="/lib/ng-flow/dist/ng-flow.min.js"></script>[m
[32m+[m[32m    <script src="/lib/ng-password-strength/dist/scripts/ng-password-strength.min.js"></script>[m
     <script src="/lib/ng-videosharing-embed/build/ng-videosharing-embed.min.js"></script>[m
     <script src="/lib/ngprogress/build/ngProgress.min.js"></script>[m
 [m
